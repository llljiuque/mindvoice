# 禅应用 (VoiceZen) 设计文档

## 概述

禅应用是一个角色扮演式的对话应用，用户可以与"一禅小和尚"进行对话，获得心灵的平静和禅宗智慧的启发。

## 应用定位

- **类型**：角色扮演对话应用
- **角色**：一禅小和尚（年轻禅师）
- **目标**：通过对话帮助用户获得内心平静，解答人生困惑
- **特色**：结合禅宗智慧与现代生活，用简单语言传达深刻道理

## 核心功能（待实现）

### 1. 长记忆库系统（多层）

**目标**：让一禅记住与用户的对话历史，建立持续的关系。

#### 记忆层级

1. **短期记忆（Session Memory）**
   - 当前会话的对话内容
   - 用户本次提到的问题和情绪
   - 生命周期：当前会话
   - 存储：内存

2. **中期记忆（Recent Memory）**
   - 最近几次对话的摘要
   - 用户反复提到的话题
   - 用户的情绪变化趋势
   - 生命周期：最近7-30天
   - 存储：SQLite 数据库

3. **长期记忆（Long-term Memory）**
   - 用户的基本信息和背景
   - 重要的人生事件和转折点
   - 长期关注的问题和困惑
   - 显著的性格特征
   - 生命周期：永久
   - 存储：SQLite 数据库 + 向量数据库

#### 实现方案

```python
class ZenMemorySystem:
    def __init__(self):
        self.short_term = []  # 当前会话
        self.mid_term_db = MidTermMemoryDB()  # 最近记忆
        self.long_term_db = LongTermMemoryDB()  # 长期记忆
        self.vector_store = VectorStore()  # 向量检索
    
    def add_conversation(self, user_input, zen_response, emotion, topics):
        """添加一轮对话到记忆系统"""
        pass
    
    def retrieve_relevant_memory(self, current_input):
        """检索与当前输入相关的记忆"""
        pass
    
    def summarize_session(self):
        """总结当前会话"""
        pass
```

### 2. 知识库系统

**目标**：存储禅宗故事、公案、智慧语录，供一禅引用。

#### 知识库内容

1. **禅宗公案**
   - 经典公案（如赵州茶去、南泉斩猫等）
   - 公案的背景、对话、启示
   - 标签：适用场景、相关主题

2. **禅门故事**
   - 历代禅师的故事
   - 现代生活中的禅意故事
   - 标签：生活场景、情绪类型

3. **智慧语录**
   - 短小精悍的禅语
   - 诗意的表达
   - 标签：情绪、主题

#### 检索机制

- **关键词检索**：根据用户问题中的关键词匹配
- **语义检索**：使用向量相似度匹配最相关的故事
- **情境检索**：根据用户当前情绪和话题选择合适的内容

```python
class ZenKnowledgeBase:
    def search_by_keyword(self, keywords):
        """关键词检索"""
        pass
    
    def search_by_semantic(self, query_embedding):
        """语义检索"""
        pass
    
    def search_by_context(self, emotion, topic):
        """情境检索"""
        pass
```

### 3. 图片库系统

**目标**：根据对话内容和情绪，展示相应的禅意图片或GIF。

#### 图片分类

1. **自然风景**
   - 山水、日出日落、云雾
   - 适用：冥想、放松、开阔心境

2. **禅宗元素**
   - 寺庙、佛像、禅房
   - 适用：正式的禅理讨论

3. **四季意象**
   - 春花、夏荷、秋叶、冬雪
   - 适用：不同季节的话题

4. **生活禅意**
   - 茶道、书法、花道
   - 适用：日常生活中的禅

5. **动态GIF**
   - 流水、风吹、火焰、雪飘
   - 适用：需要动态变化的场景

#### 图片选择逻辑

```python
class ZenImageLibrary:
    def select_image(self, emotion, topic, season):
        """根据情绪、话题、季节选择图片"""
        pass
    
    def get_random_image(self, category):
        """从指定类别随机选择图片"""
        pass
```

### 4. 音频库系统

**目标**：播放背景音乐和环境音效，增强沉浸感。

#### 音频分类

1. **背景音乐**
   - 古琴、箫、佛乐
   - 冥想音乐
   - 自然音效（流水、风声、鸟鸣）

2. **情绪音乐**
   - 平静：轻柔的古琴曲
   - 悲伤：低沉的箫声
   - 喜悦：明快的竹笛
   - 焦虑：舒缓的流水声

3. **场景音效**
   - 寺庙钟声
   - 木鱼敲击
   - 诵经声（低音量背景）

#### 音乐选择逻辑

```python
class ZenAudioLibrary:
    def select_music(self, emotion, time_of_day):
        """根据情绪和时间选择音乐"""
        pass
    
    def play_ambient_sound(self, sound_type):
        """播放环境音效"""
        pass
    
    def adjust_volume(self, speaking: bool):
        """说话时降低音量，静默时正常音量"""
        pass
```

### 5. 多维用户画像

**目标**：建立全面的用户画像，提供个性化的对话体验。

#### 画像维度

1. **基本信息**
   - 年龄段、职业、生活状态
   - 通过对话逐步推测和确认

2. **性格特征**
   - 内向/外向
   - 乐观/悲观
   - 理性/感性
   - 急躁/从容

3. **情绪模式**
   - 常见情绪类型
   - 情绪触发点
   - 情绪周期（是否有周期性低落）

4. **关注主题**
   - 工作压力
   - 人际关系
   - 人生意义
   - 情感问题
   - 健康焦虑
   - 等等

5. **禅修进度**
   - 对禅的理解程度
   - 是否实践过冥想
   - 对禅理的接受度
   - 思维方式的变化

6. **互动偏好**
   - 喜欢故事还是直接建议
   - 喜欢温和还是直接
   - 需要更多倾听还是引导

#### 画像更新机制

```python
class UserProfile:
    def __init__(self, user_id):
        self.user_id = user_id
        self.basic_info = {}
        self.personality = {}
        self.emotion_pattern = {}
        self.topics_of_interest = []
        self.zen_progress = {}
        self.interaction_preference = {}
    
    def update_from_conversation(self, conversation_data):
        """从对话中更新画像"""
        pass
    
    def get_personalized_approach(self):
        """根据画像生成个性化的对话策略"""
        pass
```

### 6. 情绪分析模型

**目标**：实时分析用户情绪，选择合适的图片、音乐和回应基调。

#### 情绪分类

1. **基础情绪**
   - 喜悦、悲伤、愤怒、恐惧、惊讶、厌恶

2. **复杂情绪**
   - 焦虑、困惑、失望、孤独、感动、平静

3. **情绪强度**
   - 轻微、中等、强烈

#### 分析方法

1. **文本分析**
   - 关键词识别（如"焦虑"、"开心"）
   - 情感词典匹配
   - LLM情绪判断

2. **语音分析**（未来扩展）
   - 语音语调
   - 说话速度
   - 音量变化

3. **多轮对话分析**
   - 情绪变化趋势
   - 反复出现的情绪

```python
class EmotionAnalyzer:
    def analyze_text(self, text):
        """分析文本情绪"""
        pass
    
    def analyze_voice(self, audio):
        """分析语音情绪（待实现）"""
        pass
    
    def get_emotion_trend(self, conversation_history):
        """获取情绪变化趋势"""
        pass
```

## 用户体验流程

### 1. 欢迎页面

```
┌─────────────────────────────┐
│                             │
│                             │
│         🪵 木鱼图标          │
│       （可点击，有动画）      │
│                             │
│     点击开始与一禅对话       │
│                             │
│                             │
└─────────────────────────────┘
```

**交互**：
- 点击木鱼：开始对话，进入对话界面
- 木鱼有呼吸动画（上下浮动）
- 鼠标悬停时木鱼放大
- 点击时有敲击动画和音效

### 2. 对话界面

```
┌─────────────────────────────────────┐
│ [一禅头像] 一禅小和尚    [再见按钮]  │
├─────────────────────────────────────┤
│                                     │
│  背景：禅意图片（会根据情绪变化）    │
│                                     │
│  对话气泡：                          │
│  ┌─────────────────┐                │
│  │ 用户消息（右侧）│                │
│  └─────────────────┘                │
│  ┌─────────────────┐                │
│  │ 一禅消息（左侧）│                │
│  └─────────────────┘                │
│                                     │
├─────────────────────────────────────┤
│ [🔇]      [🎤 点击说话]      [状态]  │
└─────────────────────────────────────┘
```

**交互**：
- 点击 🎤 开始语音输入
- 语音转文字后显示在用户气泡中
- 一禅回复显示在左侧气泡中
- 背景图片根据情绪分析结果切换
- 背景音乐随情绪变化调整
- 点击"再见"退出对话，返回欢迎页面

### 3. 对话示例

**场景1：用户表达工作压力**

```
用户："师父，我最近工作压力好大，每天都很焦虑。"

[背景图片切换为：流水或云雾]
[背景音乐：舒缓的古琴曲]

一禅："阿弥陀佛，施主辛苦了。小僧问你，是工作本身让你焦虑，
还是你对工作的担心让你焦虑？

就像有个人，白天被蛇咬了，晚上看到一根绳子都会吓一跳。
其实绳子本身不可怕，可怕的是心中的那条蛇。

工作就是工作，该做的做，该休息就休息。越是焦虑，效率反而越低。
不如试着告诉自己：我已经尽力了，剩下的交给时间。

施主觉得，能做到吗？"
```

**场景2：用户表达孤独**

```
用户："师父，我感觉很孤独，好像没人理解我。"

[背景图片切换为：月夜或秋叶]
[背景音乐：轻柔的箫声]

一禅："善哉善哉，施主的感受，小僧听到了。

孤独，不是一个人待着。而是即使身边有人，心却无处安放。

你知道吗？月亮很孤独，它一个人挂在天上。但它不觉得孤单，
因为它知道，有人抬头看它，有人对它诉说心事。

也许此刻，你觉得没人理解。但你的存在，已经是这个世界的一部分。
树叶落了，大地接住。雨滴下了，江河收留。

要不要试着，先理解自己？当你理解了自己，就不那么需要别人的理解了。

要是愿意，随时来找小僧聊聊。这里，总有一盏灯为你亮着。"
```

## 技术架构

### 前端（React）

```
VoiceZen
├── ZenWelcome（欢迎页面）
├── ZenChat（对话界面）
├── ZenMessage（消息组件）
├── ZenBackground（背景管理）
└── ZenAudio（音频控制）
```

### 后端（Python）

```
zen_service.py
├── ZenMasterLLM（一禅的 LLM 接口）
├── MemorySystem（记忆系统）
├── KnowledgeBase（知识库）
├── ImageLibrary（图片库）
├── AudioLibrary（音频库）
├── UserProfile（用户画像）
└── EmotionAnalyzer（情绪分析）
```

### 数据库

```
zen.db
├── conversations（对话记录）
├── user_profiles（用户画像）
├── memories（记忆系统）
└── knowledge_base（知识库）
```

### 向量数据库

- 使用 Chroma 或 Faiss 存储：
  - 知识库的向量表示
  - 长期记忆的向量表示
  - 用于语义检索

## 开发计划

### 阶段1：基础脚手架（当前）✅

- [x] 创建 VoiceZen 组件
- [x] 实现欢迎页面（木鱼图标）
- [x] 实现基础对话界面
- [x] 准备一禅角色提示词
- [x] 集成到主应用

### 阶段2：基础对话功能

- [ ] 集成语音输入
- [ ] 连接 LLM API（使用一禅提示词）
- [ ] 实现简单的对话流程
- [ ] 基础情绪识别（关键词匹配）
- [ ] 测试对话质量

### 阶段3：记忆系统

- [ ] 实现短期记忆（会话内）
- [ ] 实现中期记忆（最近对话）
- [ ] 实现长期记忆（重要信息）
- [ ] 记忆检索和整合
- [ ] 基于记忆的个性化回复

### 阶段4：知识库系统

- [ ] 录入禅宗公案
- [ ] 录入现代故事
- [ ] 实现关键词检索
- [ ] 实现语义检索
- [ ] 在对话中引用知识库

### 阶段5：多媒体增强

- [ ] 收集/生成禅意图片
- [ ] 实现图片分类和标签
- [ ] 情绪分析选图
- [ ] 收集背景音乐
- [ ] 实现音乐播放和切换
- [ ] 情绪分析选音乐

### 阶段6：用户画像

- [ ] 定义画像数据结构
- [ ] 从对话中提取画像信息
- [ ] 实现画像更新机制
- [ ] 基于画像调整对话策略
- [ ] 画像可视化（可选）

### 阶段7：高级情绪分析

- [ ] 集成情绪分析模型
- [ ] 多轮对话情绪追踪
- [ ] 情绪变化趋势分析
- [ ] 根据情绪调整背景和音乐
- [ ] 情绪可视化（可选）

### 阶段8：优化与完善

- [ ] 对话质量优化
- [ ] 响应速度优化
- [ ] UI/UX 优化
- [ ] 添加更多禅宗内容
- [ ] 用户反馈收集和改进

## 注意事项

1. **隐私保护**：用户的对话内容属于敏感信息，需要妥善保护
2. **心理边界**：一禅是精神导师，不是心理医生，要明确边界
3. **文化尊重**：禅宗文化博大精深，要谨慎对待，避免庸俗化
4. **响应质量**：LLM 的回复质量是核心，需要反复调试提示词
5. **沉浸体验**：图片、音乐、文字要协调一致，营造氛围

## 未来展望

1. **语音合成**：给一禅配上温和的语音，用语音回复用户
2. **动画形象**：设计一禅的动画形象，增加亲和力
3. **冥想引导**：提供冥想练习的引导
4. **禅修打卡**：帮助用户建立禅修习惯
5. **社区分享**：允许用户分享从一禅那里得到的启发（匿名）
6. **多语言**：支持英文等其他语言
7. **定制化**：允许用户自定义背景、音乐等

---

**开发者**: 深圳王哥 & AI  
**项目**: MindVoice - 禅应用  
**更新日期**: 2025-12-31  
**版本**: 0.1.0（脚手架阶段）

