# 图片粘贴功能测试指南

## 测试准备

1. **确保应用正在运行**
   ```bash
   ./quick_start.sh
   ```

2. **准备测试图片**
   - 方式1: 使用截图工具截图（如 macOS 的 Cmd+Shift+4）
   - 方式2: 在浏览器中右键复制图片
   - 方式3: 在图片查看器中复制图片

## 测试步骤

### 测试1: 基本粘贴功能
1. 打开 VoiceNote 应用
2. 创建新笔记或打开现有笔记
3. 复制一张图片到剪贴板（截图或右键复制）
4. 在笔记编辑区域按 `Ctrl+V` (或 `Cmd+V`)
5. **预期结果**: 
   - 图片应该立即显示在笔记中
   - 图片上方有 🖼️ 图标
   - 悬停时显示删除按钮

### 测试2: 图片显示样式
1. 粘贴不同尺寸的图片
2. **预期结果**:
   - 图片自动适应容器宽度
   - 保持原始宽高比
   - 有轻微的阴影和圆角效果

### 测试3: 图片删除
1. 悬停在图片块上
2. 点击右上角的 🗑️ 删除按钮
3. **预期结果**:
   - 图片块被删除
   - 笔记其他内容不受影响

### 测试4: 保存和加载
1. 粘贴图片
2. 保存笔记
3. 关闭笔记
4. 从历史记录重新打开笔记
5. **预期结果**:
   - 图片正常显示
   - 图片 URL 正确

### 测试5: 多张图片
1. 依次粘贴多张图片
2. **预期结果**:
   - 每张图片都成功显示
   - 图片按粘贴顺序排列

### 测试6: 错误处理
1. 粘贴纯文本（不包含图片）
2. **预期结果**:
   - 文本正常粘贴
   - 不创建图片块

## 检查点

### 前端检查
- [ ] 图片能正常粘贴
- [ ] 图片能正常显示
- [ ] 图片能正常删除
- [ ] 样式美观，与整体UI协调
- [ ] 悬停效果正常
- [ ] 图片加载失败时有错误提示

### 后端检查
- [ ] 图片文件保存到 `data/images/` 目录
- [ ] 文件命名格式正确（时间戳-uuid.png）
- [ ] API `/api/images/save` 返回正确
- [ ] API `/api/images/{filename}` 能访问图片
- [ ] 日志记录正常

### 数据持久化检查
- [ ] 图片块保存到笔记
- [ ] 从历史记录加载时图片正常显示
- [ ] `imageUrl` 字段正确存储
- [ ] Block 类型为 'image'

## 常见问题

### Q: 粘贴后没有反应
**可能原因**:
1. 剪贴板中没有图片数据（只有文件路径）
2. 浏览器没有剪贴板权限
3. API 服务未运行

**解决方案**:
1. 确保是"复制图片"而不是"复制图片路径"
2. 检查浏览器控制台是否有权限错误
3. 运行 `./quick_start.sh` 启动服务

### Q: 图片显示为"图片加载失败"
**可能原因**:
1. 图片文件不存在
2. API 路径错误
3. 权限问题

**解决方案**:
1. 检查 `data/images/` 目录是否存在图片文件
2. 检查浏览器 Network 面板，查看请求 URL
3. 确保 API 服务正常运行

### Q: 图片很大，加载慢
**建议**:
1. 未来版本将添加图片压缩功能
2. 目前建议粘贴前先调整图片大小
3. 可以使用截图工具控制图片尺寸

## 测试数据

### 测试用图片尺寸
- 小图: 200x200 px
- 中图: 800x600 px  
- 大图: 1920x1080 px
- 超大图: 4K (3840x2160 px)

### 测试用图片格式
- PNG (透明背景)
- JPG (普通照片)
- GIF (动图，如果浏览器支持)
- WebP (现代格式)

## 性能基准

| 操作 | 预期耗时 | 备注 |
|------|---------|------|
| 粘贴图片 | < 500ms | 小于 1MB |
| 上传保存 | < 1s | 视图片大小而定 |
| 图片显示 | < 200ms | 本地文件 |
| 删除图片块 | < 100ms | 即时响应 |

## 测试报告模板

```
测试日期: YYYY-MM-DD
测试人员: [你的名字]
应用版本: [版本号]

测试结果:
- [ ] 所有测试通过
- [ ] 部分测试通过（需要修复）
- [ ] 测试失败

问题记录:
1. [问题描述]
   - 重现步骤: 
   - 预期结果:
   - 实际结果:
   - 截图/日志:

建议改进:
1. [改进建议]
```

## 下一步

完成基本测试后，可以考虑以下增强：

1. **添加图片说明**
   - 点击图片下方添加文字说明
   - 说明文字保存到 `imageCaption` 字段

2. **拖拽上传**
   - 支持拖拽图片文件到编辑区
   - 自动创建图片块

3. **图片工具栏**
   - 调整大小
   - 对齐方式（左对齐、居中、右对齐）
   - 下载原图

4. **批量操作**
   - 批量上传多张图片
   - 图片库管理

---

开始测试吧！如有问题，请查看日志文件 `logs/api_server_*.log`

