# MindVoice æŠ€æœ¯æŠ¥å‘Š

**é¡¹ç›®åç§°**: MindVoice (è¯­éŸ³æ¡Œé¢åŠ©æ‰‹)  
**ç‰ˆæœ¬**: 1.4.1  
**æŠ¥å‘Šæ—¥æœŸ**: 2026-01-03  
**ä½œè€…**: æ·±åœ³ç‹å“¥ & AI  
**è”ç³»æ–¹å¼**: manwjh@126.com

---

## ğŸ“‹ ç›®å½•

1. [æ‰§è¡Œæ‘˜è¦](#æ‰§è¡Œæ‘˜è¦)
2. [é¡¹ç›®æ¦‚è¿°](#é¡¹ç›®æ¦‚è¿°)
3. [æŠ€æœ¯æ¶æ„](#æŠ€æœ¯æ¶æ„)
4. [æ ¸å¿ƒåŠŸèƒ½æ¨¡å—](#æ ¸å¿ƒåŠŸèƒ½æ¨¡å—)
5. [æ•°æ®æµä¸é€šä¿¡](#æ•°æ®æµä¸é€šä¿¡)
6. [ä»£ç è´¨é‡åˆ†æ](#ä»£ç è´¨é‡åˆ†æ)
7. [æ€§èƒ½ä¸ä¼˜åŒ–](#æ€§èƒ½ä¸ä¼˜åŒ–)
8. [å®‰å…¨æ€§åˆ†æ](#å®‰å…¨æ€§åˆ†æ)
9. [éƒ¨ç½²ä¸è¿ç»´](#éƒ¨ç½²ä¸è¿ç»´)
10. [æŠ€æœ¯å€ºåŠ¡ä¸æ”¹è¿›å»ºè®®](#æŠ€æœ¯å€ºåŠ¡ä¸æ”¹è¿›å»ºè®®)
11. [é™„å½•](#é™„å½•)

---

## 1. æ‰§è¡Œæ‘˜è¦

### 1.1 é¡¹ç›®ç®€ä»‹

MindVoice æ˜¯ä¸€ä¸ªåŸºäº AI çš„è·¨å¹³å°æ¡Œé¢è¯­éŸ³åŠ©æ‰‹åº”ç”¨ï¼Œé‡‡ç”¨ Electron + React å‰ç«¯å’Œ FastAPI + Python åç«¯çš„å‰åç«¯åˆ†ç¦»æ¶æ„ã€‚é¡¹ç›®é›†æˆäº†è¯­éŸ³è¯†åˆ«(ASR)ã€å¤§è¯­è¨€æ¨¡å‹(LLM)å’ŒçŸ¥è¯†åº“æ£€ç´¢(RAG)ç­‰å…ˆè¿›æŠ€æœ¯ï¼Œæä¾›äº†å››ä¸ªç‹¬ç«‹çš„æ™ºèƒ½åº”ç”¨åœºæ™¯ã€‚

### 1.2 æŠ€æœ¯æ ˆæ¦‚è§ˆ

**å‰ç«¯**ï¼š
- Electron 28.0 - è·¨å¹³å°æ¡Œé¢åº”ç”¨æ¡†æ¶
- React 18.2 - ç°ä»£åŒ– UI æ¡†æ¶
- TypeScript 5.0 - ç±»å‹å®‰å…¨çš„ JavaScript
- Vite 5.0 - å¿«é€Ÿæ„å»ºå·¥å…·

**åç«¯**ï¼š
- Python 3.9+ - æ ¸å¿ƒè¯­è¨€
- FastAPI 0.104+ - å¼‚æ­¥ Web æ¡†æ¶
- WebSocket - å®æ—¶åŒå‘é€šä¿¡
- SQLite - åµŒå…¥å¼æ•°æ®åº“

**AI æœåŠ¡**ï¼š
- ç«å±±å¼•æ“ ASR - æµå¼è¯­éŸ³è¯†åˆ«
- LiteLLM - ç»Ÿä¸€ LLM æ¥å£ï¼ˆæ”¯æŒ 100+ æ¨¡å‹ï¼‰
- ChromaDB - å‘é‡æ•°æ®åº“ï¼ˆçŸ¥è¯†åº“ï¼‰
- WebRTC VAD - è¯­éŸ³æ´»åŠ¨æ£€æµ‹

### 1.3 å…³é”®æŒ‡æ ‡

| æŒ‡æ ‡ | æ•°å€¼ |
|------|------|
| åç«¯ä»£ç è¡Œæ•° | 7,608 è¡Œ (Python) |
| å‰ç«¯ä»£ç è¡Œæ•° | 10,640 è¡Œ (TS/TSX/CSS) |
| æ€»ä»£ç è¡Œæ•° | ~18,000 è¡Œ |
| æ ¸å¿ƒæ¨¡å—æ•°é‡ | 34 ä¸ª (Python) + 24 ä¸ª (TypeScript) |
| åº”ç”¨æ•°é‡ | 4 ä¸ªç‹¬ç«‹åº”ç”¨ |
| API ç«¯ç‚¹æ•°é‡ | 30+ ä¸ª |
| æ”¯æŒçš„ LLM | 100+ ç§æ¨¡å‹ |
| å¹³å°æ”¯æŒ | macOS, Linux, Windows |

### 1.4 é¡¹ç›®æˆç†Ÿåº¦è¯„ä¼°

| ç»´åº¦ | è¯„åˆ† | è¯´æ˜ |
|------|------|------|
| æ¶æ„è®¾è®¡ | â˜…â˜…â˜…â˜…â˜† | å‰åç«¯åˆ†ç¦»ï¼Œæ¨¡å—åŒ–è®¾è®¡è‰¯å¥½ |
| ä»£ç è´¨é‡ | â˜…â˜…â˜…â˜…â˜† | ä»£ç è§„èŒƒï¼Œæ³¨é‡Šå®Œæ•´ |
| åŠŸèƒ½å®Œæ•´æ€§ | â˜…â˜…â˜…â˜…â˜† | æ ¸å¿ƒåŠŸèƒ½å®Œå–„ï¼Œéƒ¨åˆ†é«˜çº§åŠŸèƒ½å¾…å®ç° |
| æ–‡æ¡£å®Œå–„åº¦ | â˜…â˜…â˜…â˜…â˜† | æŠ€æœ¯æ–‡æ¡£è¯¦å®ï¼Œç”¨æˆ·æ–‡æ¡£è‰¯å¥½ |
| å¯æ‰©å±•æ€§ | â˜…â˜…â˜…â˜…â˜… | æ’ä»¶åŒ–æ¶æ„ï¼Œæ˜“äºæ‰©å±• |
| æ€§èƒ½ä¼˜åŒ– | â˜…â˜…â˜…â˜†â˜† | åŸºæœ¬æ€§èƒ½è‰¯å¥½ï¼Œæœ‰ä¼˜åŒ–ç©ºé—´ |
| å®‰å…¨æ€§ | â˜…â˜…â˜…â˜†â˜† | åŸºç¡€å®‰å…¨æªæ–½åˆ°ä½ï¼Œéœ€åŠ å¼º |
| æµ‹è¯•è¦†ç›– | â˜…â˜…â˜†â˜†â˜† | ç¼ºå°‘è‡ªåŠ¨åŒ–æµ‹è¯• |

---

## 2. é¡¹ç›®æ¦‚è¿°

### 2.1 ä¸šåŠ¡èƒŒæ™¯

éšç€ AI æŠ€æœ¯çš„å¿«é€Ÿå‘å±•ï¼Œè¯­éŸ³äº¤äº’æˆä¸ºäººæœºäº¤äº’çš„é‡è¦æ–¹å¼ã€‚MindVoice é¡¹ç›®æ—¨åœ¨æä¾›ä¸€ä¸ªæœ¬åœ°åŒ–ã€å¯æ‰©å±•çš„è¯­éŸ³åŠ©æ‰‹è§£å†³æ–¹æ¡ˆï¼Œæ»¡è¶³ä»¥ä¸‹éœ€æ±‚ï¼š

1. **å®æ—¶è¯­éŸ³è½¬æ–‡å­—**ï¼šå¿«é€Ÿå‡†ç¡®çš„è¯­éŸ³è¯†åˆ«
2. **æ™ºèƒ½å¯¹è¯åŠ©æ‰‹**ï¼šåŸºäºå¤§è¯­è¨€æ¨¡å‹çš„æ™ºèƒ½é—®ç­”
3. **çŸ¥è¯†åº“ç®¡ç†**ï¼šä¼ä¸š/ä¸ªäººçŸ¥è¯†çš„å­˜å‚¨å’Œæ£€ç´¢
4. **ç¦…æ„åº”ç”¨**ï¼šå¿ƒçµå¹³é™ä¸ç¦…å®—æ™ºæ…§çš„å¯¹è¯

### 2.2 æ ¸å¿ƒç‰¹æ€§

#### 2.2.1 è¯­éŸ³ç¬”è®° (VoiceNote)
å®æ—¶è¯­éŸ³è½¬æ–‡å­—è®°å½•å·¥å…·ï¼Œæ”¯æŒå¯Œæ–‡æœ¬ç¼–è¾‘å’Œæ™ºèƒ½æ‘˜è¦ã€‚

**å…³é”®åŠŸèƒ½**ï¼š
- æµå¼ ASR å®æ—¶è¯†åˆ«ï¼ˆå»¶è¿Ÿ < 500msï¼‰
- æ™ºèƒ½åˆ†æ®µï¼ˆåŸºäº utteranceï¼‰
- å¯Œæ–‡æœ¬å—ç¼–è¾‘å™¨ï¼ˆæ”¯æŒæ ‡é¢˜ã€åˆ—è¡¨ã€ä»£ç å—ï¼‰
- AI æ™ºèƒ½æ‘˜è¦ï¼ˆåŸºäº Agentï¼‰
- ç¬”è®°ä¿¡æ¯ç®¡ç†ï¼ˆæ ‡é¢˜ã€ç±»å‹ã€å‚ä¸äººã€æ—¶é—´ç­‰ï¼‰
- å†å²ä»»åŠ¡æ¢å¤ï¼ˆå¯ç»§ç»­ç¼–è¾‘å†å²ç¬”è®°ï¼‰

#### 2.2.2 æ™ºèƒ½åŠ©æ‰‹ (SmartChat)
ä¸ AI è¿›è¡Œæ™ºèƒ½å¯¹è¯ï¼Œæ”¯æŒçŸ¥è¯†åº“æ£€ç´¢å¢å¼ºï¼ˆRAGï¼‰ã€‚

**å…³é”®åŠŸèƒ½**ï¼š
- å¤šè½®å¯¹è¯ç®¡ç†ï¼ˆä¸Šä¸‹æ–‡è®°å¿†ï¼‰
- çŸ¥è¯†åº“æ£€ç´¢å¢å¼ºï¼ˆå¯å¼€å…³ï¼‰
- æµå¼å“åº”ï¼ˆé€å­—æ˜¾ç¤ºï¼‰
- å¯¹è¯æ¨¡å¼åˆ‡æ¢ï¼ˆç®€æ´/ä¸“ä¸š/åˆ›æ„ï¼‰
- å¯¹è¯å†å²è®°å½•

#### 2.2.3 ç¦…åº”ç”¨ (VoiceZen)
ä¸"ä¸€ç¦…å°å’Œå°š"å¯¹è¯ï¼Œè·å¾—ç¦…å®—æ™ºæ…§å’Œå¿ƒçµå¹³é™ã€‚

**å…³é”®åŠŸèƒ½**ï¼š
- è§’è‰²æ‰®æ¼”å¼å¯¹è¯
- ç¦…æ„ç¾å­¦è®¾è®¡ï¼ˆå¤æœ´å…¸é›…é£æ ¼ï¼‰
- æœ¨é±¼äº¤äº’åŠ¨ç”»
- æ²‰æµ¸å¼ç¦…å¢ƒç•Œé¢

#### 2.2.4 çŸ¥è¯†åº“ (KnowledgeBase)
ç®¡ç†çŸ¥è¯†åº“æ–‡æ¡£ï¼Œæ”¯æŒæ–‡æ¡£ä¸Šä¼ ã€æŸ¥çœ‹å’Œåˆ é™¤ã€‚

**å…³é”®åŠŸèƒ½**ï¼š
- æ–‡æ¡£ä¸Šä¼ ï¼ˆ.md, .txtï¼‰
- è‡ªåŠ¨å‘é‡åŒ–å¤„ç†
- æ–‡æ¡£å†…å®¹é¢„è§ˆ
- ä¸æ™ºèƒ½åŠ©æ‰‹é›†æˆï¼ˆRAGï¼‰

### 2.3 æŠ€æœ¯é€‰å‹ç†ç”±

#### 2.3.1 ä¸ºä»€ä¹ˆé€‰æ‹© Electron + Reactï¼Ÿ

**ä¼˜åŠ¿**ï¼š
- **è·¨å¹³å°**ï¼šä¸€å¥—ä»£ç è¿è¡Œäº macOS/Linux/Windows
- **ç°ä»£åŒ– UI**ï¼šReact ç”Ÿæ€ä¸°å¯Œï¼Œå¼€å‘æ•ˆç‡é«˜
- **æœ¬åœ°åŒ–**ï¼šæ— éœ€æµè§ˆå™¨ï¼Œç‹¬ç«‹åº”ç”¨ä½“éªŒ
- **ç³»ç»Ÿé›†æˆ**ï¼šå¯è®¿é—®æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿã€ç³»ç»Ÿæ‰˜ç›˜ç­‰

**åŠ£åŠ¿**ï¼š
- åº”ç”¨ä½“ç§¯è¾ƒå¤§ï¼ˆ~150MBï¼‰
- å†…å­˜å ç”¨ç›¸å¯¹è¾ƒé«˜ï¼ˆ~200MBï¼‰

#### 2.3.2 ä¸ºä»€ä¹ˆé€‰æ‹© FastAPIï¼Ÿ

**ä¼˜åŠ¿**ï¼š
- **é«˜æ€§èƒ½**ï¼šåŸºäº ASGIï¼Œæ”¯æŒå¼‚æ­¥ I/O
- **ç±»å‹å®‰å…¨**ï¼šPydantic æ•°æ®éªŒè¯
- **è‡ªåŠ¨æ–‡æ¡£**ï¼šOpenAPI/Swagger è‡ªåŠ¨ç”Ÿæˆ
- **æ˜“äºå¼€å‘**ï¼šç®€æ´çš„ APIï¼Œå¼€å‘æ•ˆç‡é«˜

**åŠ£åŠ¿**ï¼š
- Python GIL é™åˆ¶ï¼ˆä½†æœ¬é¡¹ç›®ä¸»è¦æ˜¯ I/O å¯†é›†å‹ï¼Œå½±å“ä¸å¤§ï¼‰

#### 2.3.3 ä¸ºä»€ä¹ˆé€‰æ‹©å‰åç«¯åˆ†ç¦»ï¼Ÿ

**ä¼˜åŠ¿**ï¼š
1. **æŠ€æœ¯è§£è€¦**ï¼šå‰åç«¯ç‹¬ç«‹å¼€å‘ã€éƒ¨ç½²
2. **æ˜“äºæ›¿æ¢**ï¼šå¯è½»æ¾æ›´æ¢å‰ç«¯æ¡†æ¶ï¼ˆWeb/ç§»åŠ¨ç«¯ï¼‰
3. **æ‰©å±•æ€§å¼º**ï¼šåç«¯ API å¯è¢«å¤šä¸ªå®¢æˆ·ç«¯è°ƒç”¨
4. **ç»´æŠ¤æ€§å¥½**ï¼šèŒè´£æ¸…æ™°ï¼Œä¾¿äºç»´æŠ¤

---

## 3. æŠ€æœ¯æ¶æ„

### 3.1 æ€»ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       å‰ç«¯å±‚ (Electron + React)              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ VoiceNoteâ”‚  â”‚SmartChat â”‚  â”‚ VoiceZen â”‚  â”‚Knowledge â”‚   â”‚
â”‚  â”‚          â”‚  â”‚          â”‚  â”‚          â”‚  â”‚   Base   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜   â”‚
â”‚       â”‚             â”‚              â”‚             â”‚          â”‚
â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                          â”‚                                   â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”                            â”‚
â”‚                    â”‚  App.tsx  â”‚  (çŠ¶æ€ç®¡ç†ã€è·¯ç”±)           â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                    HTTP / WebSocket
                           â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    åç«¯å±‚ (FastAPI + Python)                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                  API æœåŠ¡å±‚ (server.py)               â”‚   â”‚
â”‚  â”‚     - REST API (30+ endpoints)                       â”‚   â”‚
â”‚  â”‚     - WebSocket (å®æ—¶é€šä¿¡)                           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚          â”‚                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ VoiceService   â”‚  LLMService   â”‚KnowledgeServiceâ”‚        â”‚
â”‚  â”‚ (ASRç®¡ç†)      â”‚  (LLMå¯¹è¯)    â”‚  (RAGæ£€ç´¢)     â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚          â”‚                â”‚                â”‚                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚  ASR Provider  â”‚  â”‚LLM Providerâ”‚  â”‚ChromaDB     â”‚        â”‚
â”‚  â”‚  (ç«å±±å¼•æ“)     â”‚  â”‚ (LiteLLM)  â”‚  â”‚(å‘é‡æ•°æ®åº“) â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              Agent å±‚ (æ™ºèƒ½ä½“ç³»ç»Ÿ)                    â”‚   â”‚
â”‚  â”‚   - SummaryAgent (æ‘˜è¦ç”Ÿæˆ)                          â”‚   â”‚
â”‚  â”‚   - SmartChatAgent (æ™ºèƒ½å¯¹è¯)                        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              æ•°æ®å­˜å‚¨å±‚ (SQLite)                      â”‚   â”‚
â”‚  â”‚   - å†å²è®°å½• (records)                               â”‚   â”‚
â”‚  â”‚   - å…ƒæ•°æ® (metadata: blocks, noteInfo, etc.)       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 æ¨¡å—åŒ–è®¾è®¡

#### 3.2.1 åç«¯æ¨¡å—ç»“æ„

```
src/
â”œâ”€â”€ api/                          # API æœåŠ¡å±‚
â”‚   â””â”€â”€ server.py                 # FastAPI åº”ç”¨ä¸»å…¥å£
â”‚
â”œâ”€â”€ core/                         # æ ¸å¿ƒæ¨¡å—
â”‚   â”œâ”€â”€ config.py                 # é…ç½®ç®¡ç†ï¼ˆæ”¯æŒå¤šå±‚çº§é…ç½®ï¼‰
â”‚   â”œâ”€â”€ logger.py                 # æ—¥å¿—ç³»ç»Ÿï¼ˆå½©è‰²è¾“å‡ºã€æ–‡ä»¶è®°å½•ï¼‰
â”‚   â”œâ”€â”€ error_codes.py            # é”™è¯¯ä»£ç ç³»ç»Ÿï¼ˆç»“æ„åŒ–é”™è¯¯å¤„ç†ï¼‰
â”‚   â”œâ”€â”€ base.py                   # åŸºç¡€ç±»å’Œæšä¸¾
â”‚   â””â”€â”€ plugin_manager.py         # æ’ä»¶ç®¡ç†å™¨ï¼ˆæœªä½¿ç”¨ï¼‰
â”‚
â”œâ”€â”€ providers/                    # æä¾›å•†æ¥å£å±‚
â”‚   â”œâ”€â”€ asr/                      # ASR æä¾›å•†
â”‚   â”‚   â”œâ”€â”€ base_asr.py           # ASR åŸºç±»æ¥å£
â”‚   â”‚   â”œâ”€â”€ volcano.py            # ç«å±±å¼•æ“å®ç° (åŒå‘æµå¼)
â”‚   â”‚   â””â”€â”€ example.py            # ç¤ºä¾‹æä¾›å•†
â”‚   â”œâ”€â”€ llm/                      # LLM æä¾›å•†
â”‚   â”‚   â”œâ”€â”€ base_llm.py           # LLM åŸºç±»æ¥å£
â”‚   â”‚   â””â”€â”€ litellm_provider.py   # LiteLLM å®ç° (100+ æ¨¡å‹)
â”‚   â””â”€â”€ storage/                  # å­˜å‚¨æä¾›å•†
â”‚       â”œâ”€â”€ base_storage.py       # å­˜å‚¨åŸºç±»æ¥å£
â”‚       â””â”€â”€ sqlite.py             # SQLite å®ç°
â”‚
â”œâ”€â”€ services/                     # ä¸šåŠ¡æœåŠ¡å±‚
â”‚   â”œâ”€â”€ voice_service.py          # è¯­éŸ³æœåŠ¡ï¼ˆASR ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼‰
â”‚   â”œâ”€â”€ llm_service.py            # LLM æœåŠ¡ï¼ˆå¯¹è¯ç®¡ç†ï¼‰
â”‚   â””â”€â”€ knowledge_service.py      # çŸ¥è¯†åº“æœåŠ¡ï¼ˆRAG æ£€ç´¢ï¼‰
â”‚
â”œâ”€â”€ agents/                       # AI æ™ºèƒ½ä½“å±‚
â”‚   â”œâ”€â”€ base_agent.py             # Agent åŸºç±»
â”‚   â”œâ”€â”€ summary_agent.py          # æ‘˜è¦ç”Ÿæˆ Agent
â”‚   â”œâ”€â”€ smart_chat_agent.py       # æ™ºèƒ½å¯¹è¯ Agent (æ”¯æŒ RAG)
â”‚   â””â”€â”€ prompts/                  # æç¤ºè¯é…ç½®
â”‚       â”œâ”€â”€ prompt_loader.py      # æç¤ºè¯åŠ è½½å™¨
â”‚       â”œâ”€â”€ summary_agent.yml     # æ‘˜è¦ Agent é…ç½®
â”‚       â””â”€â”€ smart_chat_agent.yml  # æ™ºèƒ½å¯¹è¯ Agent é…ç½®
â”‚
â”œâ”€â”€ prompts/                      # AI è§’è‰²æç¤ºè¯
â”‚   â””â”€â”€ zen_master_prompt.py      # ä¸€ç¦…å°å’Œå°šæç¤ºè¯
â”‚
â””â”€â”€ utils/                        # å·¥å…·æ¨¡å—
    â”œâ”€â”€ audio_recorder.py         # éŸ³é¢‘å½•åˆ¶ï¼ˆsounddeviceï¼‰
    â””â”€â”€ audio_asr_gateway.py      # Audio-ASR ç½‘å…³æ§åˆ¶å™¨
```

**è®¾è®¡äº®ç‚¹**ï¼š
1. **åˆ†å±‚æ¸…æ™°**ï¼šAPI â†’ Service â†’ Providerï¼ŒèŒè´£åˆ†æ˜
2. **æ¥å£æŠ½è±¡**ï¼šBaseASRã€BaseLLMã€BaseStorageï¼Œæ˜“äºæ‰©å±•
3. **æ’ä»¶åŒ–**ï¼šæ–°å¢æä¾›å•†åªéœ€ç»§æ‰¿åŸºç±»
4. **é…ç½®åˆ†ç¦»**ï¼šé…ç½®ä¸ä»£ç åˆ†ç¦»ï¼Œä¾¿äºéƒ¨ç½²

#### 3.2.2 å‰ç«¯æ¨¡å—ç»“æ„

```
electron-app/src/
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ apps/                     # åº”ç”¨ç»„ä»¶ï¼ˆ4ä¸ªç‹¬ç«‹åº”ç”¨ï¼‰
â”‚   â”‚   â”œâ”€â”€ VoiceNote/            # è¯­éŸ³ç¬”è®°
â”‚   â”‚   â”‚   â”œâ”€â”€ VoiceNote.tsx     # ä¸»ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ BlockEditor.tsx   # å¯Œæ–‡æœ¬å—ç¼–è¾‘å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ TimelineIndicator.tsx  # æ—¶é—´çº¿æŒ‡ç¤ºå™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ FormatToolbar.tsx # æ ¼å¼å·¥å…·æ 
â”‚   â”‚   â”‚   â””â”€â”€ WelcomeScreen.tsx # æ¬¢è¿ç•Œé¢
â”‚   â”‚   â”œâ”€â”€ SmartChat/            # æ™ºèƒ½åŠ©æ‰‹
â”‚   â”‚   â”‚   â”œâ”€â”€ SmartChat.tsx     # ä¸»ç»„ä»¶
â”‚   â”‚   â”‚   â””â”€â”€ WelcomeScreen.tsx # æ¬¢è¿ç•Œé¢
â”‚   â”‚   â”œâ”€â”€ VoiceZen/             # ç¦…åº”ç”¨
â”‚   â”‚   â”‚   â”œâ”€â”€ VoiceZen.tsx      # ä¸»ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ ZenChat.tsx       # ç¦…å¯¹è¯ç»„ä»¶
â”‚   â”‚   â”‚   â””â”€â”€ ZenWelcome.tsx    # ç¦…æ¬¢è¿ç•Œé¢
â”‚   â”‚   â””â”€â”€ KnowledgeBase/        # çŸ¥è¯†åº“
â”‚   â”‚       â””â”€â”€ KnowledgeBase.tsx # ä¸»ç»„ä»¶
â”‚   â””â”€â”€ shared/                   # å…±äº«ç»„ä»¶
â”‚       â”œâ”€â”€ AppLayout.tsx         # åº”ç”¨å¸ƒå±€
â”‚       â”œâ”€â”€ Sidebar.tsx           # ä¾§è¾¹æ å¯¼èˆª
â”‚       â”œâ”€â”€ StatusIndicator.tsx   # çŠ¶æ€æŒ‡ç¤ºå™¨
â”‚       â”œâ”€â”€ Toast.tsx             # æç¤ºæ¶ˆæ¯
â”‚       â”œâ”€â”€ SystemErrorDisplay.tsx # é”™è¯¯æ˜¾ç¤º
â”‚       â”œâ”€â”€ HistoryView.tsx       # å†å²è®°å½•
â”‚       â”œâ”€â”€ SettingsView.tsx      # è®¾ç½®é¡µé¢
â”‚       â”œâ”€â”€ AboutView.tsx         # å…³äºé¡µé¢
â”‚       â”œâ”€â”€ AppButton.tsx         # åº”ç”¨æŒ‰é’®
â”‚       â””â”€â”€ ConfirmDialog.tsx     # ç¡®è®¤å¯¹è¯æ¡†
â”‚
â”œâ”€â”€ utils/                        # å·¥å…·å‡½æ•°
â”‚   â””â”€â”€ errorCodes.ts             # é”™è¯¯ä»£ç å®šä¹‰
â”‚
â”œâ”€â”€ version.ts                    # ç‰ˆæœ¬é…ç½®ï¼ˆå”¯ä¸€æ¥æºï¼‰
â”œâ”€â”€ App.tsx                       # ä¸»åº”ç”¨ï¼ˆçŠ¶æ€ç®¡ç†ã€è·¯ç”±ï¼‰
â””â”€â”€ main.tsx                      # åº”ç”¨å…¥å£

electron/                         # Electron ä¸»è¿›ç¨‹
â”œâ”€â”€ main.ts                       # ä¸»è¿›ç¨‹å…¥å£
â””â”€â”€ preload.ts                    # é¢„åŠ è½½è„šæœ¬
```

**è®¾è®¡äº®ç‚¹**ï¼š
1. **ç»„ä»¶å¤ç”¨**ï¼šå…±äº«ç»„ä»¶åº“ï¼ˆAppLayoutã€StatusIndicator ç­‰ï¼‰
2. **æ¨¡å—ç‹¬ç«‹**ï¼šæ¯ä¸ªåº”ç”¨ç‹¬ç«‹å¼€å‘ï¼Œäº’ä¸å½±å“
3. **çŠ¶æ€é›†ä¸­**ï¼šApp.tsx é›†ä¸­ç®¡ç†å…¨å±€çŠ¶æ€
4. **ç±»å‹å®‰å…¨**ï¼šTypeScript æä¾›å®Œæ•´çš„ç±»å‹æ£€æŸ¥

### 3.3 è®¾è®¡æ¨¡å¼åº”ç”¨

#### 3.3.1 Provider Pattern (æä¾›å•†æ¨¡å¼)
æ‰€æœ‰å¤–éƒ¨æœåŠ¡ï¼ˆASRã€LLMã€Storageï¼‰éƒ½é€šè¿‡ Provider æ¥å£å°è£…ï¼Œä¾¿äºæ›¿æ¢å’Œæ‰©å±•ã€‚

```python
# å®šä¹‰æ¥å£
class ASRProvider(ABC):
    @abstractmethod
    async def start_stream(self):
        pass
    
    @abstractmethod
    async def send_audio(self, audio_data: bytes):
        pass

# å®ç°æä¾›å•†
class VolcanoASR(ASRProvider):
    async def start_stream(self):
        # ç«å±±å¼•æ“ç‰¹å®šå®ç°
        pass
```

#### 3.3.2 Service Layer Pattern (æœåŠ¡å±‚æ¨¡å¼)
ä¸šåŠ¡é€»è¾‘å°è£…åœ¨ Service å±‚ï¼ŒAPI å±‚åªè´Ÿè´£è¯·æ±‚å¤„ç†ã€‚

```python
# æœåŠ¡å±‚
class VoiceService:
    def start_recording(self, app_id: str):
        # ä¸šåŠ¡é€»è¾‘
        pass

# API å±‚
@app.post("/api/recording/start")
async def start_recording(request: StartRequest):
    return voice_service.start_recording(request.app_id)
```

#### 3.3.3 Observer Pattern (è§‚å¯Ÿè€…æ¨¡å¼)
ä½¿ç”¨å›è°ƒæœºåˆ¶å®ç°äº‹ä»¶é€šçŸ¥ï¼Œè§£è€¦ç»„ä»¶é—´çš„ä¾èµ–ã€‚

```python
# æ³¨å†Œå›è°ƒ
voice_service.set_on_text_callback(broadcast_text_update)

# äº‹ä»¶è§¦å‘
self._on_text_callback(text, is_definite)
```

#### 3.3.4 Singleton Pattern (å•ä¾‹æ¨¡å¼)
å…¨å±€æœåŠ¡å®ä¾‹ï¼ˆvoice_serviceã€llm_serviceï¼‰ä½¿ç”¨å•ä¾‹æ¨¡å¼ã€‚

```python
# å…¨å±€å®ä¾‹
voice_service: Optional[VoiceService] = None

def setup_voice_service():
    global voice_service
    if voice_service is None:
        voice_service = VoiceService(config, asr_provider)
```

---

## 4. æ ¸å¿ƒåŠŸèƒ½æ¨¡å—

### 4.1 è¯­éŸ³è¯†åˆ« (ASR) æ¨¡å—

#### 4.1.1 æ¶æ„è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    VoiceService (æœåŠ¡å±‚)                    â”‚
â”‚  - å½•éŸ³ç”Ÿå‘½å‘¨æœŸç®¡ç†                                         â”‚
â”‚  - çŠ¶æ€æœºç®¡ç† (idle â†’ recording â†’ stopping)                â”‚
â”‚  - äº‹ä»¶é€šçŸ¥ (å›è°ƒæœºåˆ¶)                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ AudioRecorder  â”‚    â”‚  ASR Provider  â”‚
â”‚ (éŸ³é¢‘å½•åˆ¶)      â”‚    â”‚  (è¯­éŸ³è¯†åˆ«)     â”‚
â”‚                â”‚    â”‚                â”‚
â”‚ - sounddevice  â”‚    â”‚ - ç«å±±å¼•æ“      â”‚
â”‚ - 16kHz, å•å£°é“â”‚    â”‚ - åŒå‘æµå¼     â”‚
â”‚ - VAD è¿‡æ»¤     â”‚    â”‚ - äºŒéè¯†åˆ«     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 4.1.2 å…³é”®ç‰¹æ€§

**1. åŒå‘æµå¼è¯†åˆ«**

ç«å±±å¼•æ“æ”¯æŒä¸‰ç§æ¨¡å¼ï¼š
- `bigmodel_async`ï¼ˆæ¨èï¼‰ï¼šåŒå‘æµå¼ä¼˜åŒ–ç‰ˆæœ¬ï¼Œå®æ—¶æ€§æœ€ä½³
- `bigmodel`ï¼šåŒå‘æµå¼æ™®é€šç‰ˆæœ¬
- `bigmodel_nostream`ï¼šæµå¼è¾“å…¥æ¨¡å¼ï¼Œå‡†ç¡®ç‡æœ€é«˜

**2. äºŒéè¯†åˆ«**

å¯ç”¨åå¯åœ¨ä¿æŒå®æ—¶æ€§çš„åŒæ—¶æé«˜å‡†ç¡®ç‡ï¼š
- ç¬¬ä¸€éï¼šå®æ—¶è¿”å›ç»“æœï¼ˆä½å»¶è¿Ÿï¼‰
- ç¬¬äºŒéï¼šè¿”å›ä¼˜åŒ–ç»“æœï¼ˆé«˜å‡†ç¡®ç‡ï¼‰

**3. VAD è¯­éŸ³æ´»åŠ¨æ£€æµ‹**

ä½¿ç”¨ WebRTC VAD è‡ªåŠ¨è¿‡æ»¤é™éŸ³ï¼š
- èŠ‚çº¦ 40-60% çš„ ASR æˆæœ¬
- è‡ªåŠ¨æ£€æµ‹è¯­éŸ³å¼€å§‹/ç»“æŸ
- å¯é…ç½®çš„æ£€æµ‹é˜ˆå€¼

**4. æ™ºèƒ½ç¼“å†²åŒºç®¡ç†**

è§£å†³é•¿æ—¶é—´å½•éŸ³çš„å†…å­˜ç´¯ç§¯é—®é¢˜ï¼š
- é»˜è®¤ä¿ç•™æœ€è¿‘ 60 ç§’éŸ³é¢‘
- è‡ªåŠ¨æ¸…ç†æ—§æ•°æ®ï¼ˆä¿ç•™ 50%ï¼‰
- ä¸å½±å“å®æ—¶è¯†åˆ«

#### 4.1.3 æ•°æ®æµ

```
[éº¦å…‹é£] â†’ [sounddeviceé‡‡é›†]
           â†“
      [16kHz, å•å£°é“, PCM]
           â†“
      [VADæ£€æµ‹] â†’ [é™éŸ³? Yes â†’ ä¸¢å¼ƒ]
           â†“ No
      [AudioASRGateway] â†’ [ç¼“å†²ç®¡ç†]
           â†“
      [WebSocket] â†’ [ç«å±±å¼•æ“ASR]
           â†“
      [è¯†åˆ«ç»“æœ] â†’ [text_update / text_final]
           â†“
      [WebSocket] â†’ [å‰ç«¯æ˜¾ç¤º]
```

#### 4.1.4 ä»£ç ç¤ºä¾‹

```python
# src/services/voice_service.py
class VoiceService:
    def start_recording(self, app_id: str = None) -> bool:
        """å¼€å§‹å½•éŸ³"""
        # 1. å¯åŠ¨éŸ³é¢‘å½•åˆ¶
        self.recorder.start_recording()
        
        # 2. è®¾ç½® Gateway å›è°ƒ
        self.gateway.set_on_speech_start_callback(self._on_speech_start)
        self.gateway.set_on_speech_data_callback(self._send_audio_to_asr)
        
        # 3. Gateway æ ¹æ®é…ç½®å†³å®šä½•æ—¶å¯åŠ¨ ASR
        # (VAD æ£€æµ‹åˆ°è¯­éŸ³åè‡ªåŠ¨å¯åŠ¨)
        
        return True
    
    async def _send_audio_to_asr(self, audio_data: bytes):
        """å‘é€éŸ³é¢‘åˆ° ASR"""
        if self._asr_started:
            await self.asr_provider.send_audio(audio_data)
```

### 4.2 å¤§è¯­è¨€æ¨¡å‹ (LLM) æ¨¡å—

#### 4.2.1 LiteLLM é›†æˆ

MindVoice ä½¿ç”¨ LiteLLM ä½œä¸ºç»Ÿä¸€çš„ LLM æ¥å£ï¼Œæ”¯æŒ 100+ ç§æ¨¡å‹ï¼š

**æ”¯æŒçš„æœåŠ¡**ï¼š
- OpenAI (GPT-4, GPT-3.5, GPT-4o)
- Anthropic (Claude 3.5, Claude 3)
- é˜¿é‡Œäº‘ï¼ˆé€šä¹‰åƒé—® Qwenï¼‰
- DeepSeek
- ç™¾åº¦ï¼ˆæ–‡å¿ƒä¸€è¨€ï¼‰
- Google (Gemini)
- è‡ªå®šä¹‰ OpenAI å…¼å®¹æœåŠ¡

**é…ç½®ç¤ºä¾‹**ï¼š
```yaml
llm:
  provider: perfxcloud-ä¸“çº¿
  api_key: "your-api-key"
  base_url: https://api.example.com/v1
  model: openai/Qwen3-Next-80B-Instruct
  max_context_tokens: 128000
  temperature: 0.7
  stream: true
```

#### 4.2.2 LLM Service æ¶æ„

```python
class LLMService:
    """LLMæœåŠ¡ç®¡ç†ç±»"""
    
    def __init__(self, config: Config, llm_provider):
        self.config = config
        self.llm_provider = llm_provider
        self.conversation_history = []
    
    async def chat_stream(
        self, 
        message: str, 
        system_prompt: Optional[str] = None,
        temperature: float = 0.7
    ) -> AsyncIterator[str]:
        """æµå¼å¯¹è¯"""
        # æ„å»ºæ¶ˆæ¯
        messages = self._build_messages(message, system_prompt)
        
        # è°ƒç”¨ LiteLLM
        async for chunk in self.llm_provider.chat_stream(
            messages=messages,
            temperature=temperature
        ):
            yield chunk
```

#### 4.2.3 Agent ç³»ç»Ÿ

**SummaryAgent (æ‘˜è¦ç”Ÿæˆ)**ï¼š
- åŸºäºç¬”è®°å†…å®¹ç”Ÿæˆæ™ºèƒ½æ‘˜è¦
- æ”¯æŒæµå¼è¾“å‡º
- å¯é…ç½®æ‘˜è¦é£æ ¼ï¼ˆç®€æ´/è¯¦ç»†ï¼‰

**SmartChatAgent (æ™ºèƒ½å¯¹è¯)**ï¼š
- å¤šè½®å¯¹è¯ç®¡ç†
- ä¸Šä¸‹æ–‡è®°å¿†ï¼ˆå¯é…ç½®å†å²è½®æ•°ï¼‰
- çŸ¥è¯†åº“æ£€ç´¢å¢å¼ºï¼ˆRAGï¼‰
- å¤šç§å¯¹è¯æ¨¡å¼ï¼ˆç®€æ´/ä¸“ä¸š/åˆ›æ„ï¼‰

**æç¤ºè¯é…ç½®åŒ–**ï¼š
```yaml
# agents/prompts/smart_chat_agent.yml
metadata:
  name: "SmartChat æ™ºèƒ½åŠ©æ‰‹"
  description: "æ”¯æŒä¸Šä¸‹æ–‡è®°å¿†å’ŒçŸ¥è¯†åº“æ£€ç´¢çš„æ™ºèƒ½å¯¹è¯åŠ©æ‰‹"
  version: "1.0.0"

system_prompt: |
  ä½ æ˜¯ä¸€ä¸ªæ™ºèƒ½åŠ©æ‰‹ï¼Œå…·å¤‡ä»¥ä¸‹èƒ½åŠ›ï¼š
  1. ç†è§£ä¸Šä¸‹æ–‡ï¼Œæä¾›è¿è´¯çš„å¤šè½®å¯¹è¯
  2. åŸºäºçŸ¥è¯†åº“æä¾›å‡†ç¡®çš„å›ç­”
  3. ç”¨æ¸…æ™°ã€å‹å¥½çš„è¯­è¨€è¡¨è¾¾

parameters:
  temperature: 0.7
  max_tokens: 4000
  stream: true
```

### 4.3 çŸ¥è¯†åº“ (RAG) æ¨¡å—

#### 4.3.1 æ¶æ„è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              KnowledgeService                      â”‚
â”‚  - æ–‡æ¡£ç®¡ç† (ä¸Šä¼ /åˆ é™¤)                            â”‚
â”‚  - æ–‡æ¡£åˆ†å— (Chunking)                            â”‚
â”‚  - å‘é‡åŒ– (Embedding)                             â”‚
â”‚  - ç›¸ä¼¼åº¦æ£€ç´¢ (Similarity Search)                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                 â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ChromaDB      â”‚  â”‚ Embedding     â”‚
â”‚  (å‘é‡æ•°æ®åº“)   â”‚  â”‚ Model         â”‚
â”‚                â”‚  â”‚               â”‚
â”‚ - æŒä¹…åŒ–å­˜å‚¨   â”‚  â”‚ - all-MiniLM  â”‚
â”‚ - ä½™å¼¦ç›¸ä¼¼åº¦   â”‚  â”‚ - L6-v2       â”‚
â”‚ - å…ƒæ•°æ®è¿‡æ»¤   â”‚  â”‚ - ~80MB       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 4.3.2 å…³é”®ç‰¹æ€§

**1. å»¶è¿ŸåŠ è½½**

Embedding æ¨¡å‹åœ¨åå°åŠ è½½ï¼Œä¸é˜»å¡åº”ç”¨å¯åŠ¨ï¼š
```python
async def start_background_load(self):
    """å¯åŠ¨åå°æ¨¡å‹åŠ è½½ä»»åŠ¡"""
    loop = asyncio.get_running_loop()
    task = loop.create_task(self._background_load())
    return task
```

**2. æ™ºèƒ½åˆ†å—**

æ–‡æ¡£è‡ªåŠ¨åˆ†å—ï¼Œä¼˜åŒ–æ£€ç´¢æ•ˆæœï¼š
- é»˜è®¤å—å¤§å°ï¼š1000 å­—ç¬¦
- é‡å å¤§å°ï¼š200 å­—ç¬¦
- ä¿ç•™è¯­ä¹‰å®Œæ•´æ€§

**3. å…ƒæ•°æ®ç®¡ç†**

æ¯ä¸ªæ–‡æ¡£å—åŒ…å«ä¸°å¯Œçš„å…ƒæ•°æ®ï¼š
```python
metadata = {
    "filename": "document.md",
    "chunk_index": 0,
    "total_chunks": 10,
    "created_at": "2026-01-03",
    "file_type": "markdown"
}
```

**4. RAG é›†æˆ**

SmartChatAgent è‡ªåŠ¨ä½¿ç”¨çŸ¥è¯†åº“å¢å¼ºå›ç­”ï¼š
```python
async def chat_with_rag(self, query: str):
    """å¸¦ RAG çš„å¯¹è¯"""
    # 1. æ£€ç´¢ç›¸å…³æ–‡æ¡£
    docs = await self.knowledge_service.query(query, top_k=3)
    
    # 2. æ„å»ºå¢å¼ºæç¤ºè¯
    context = "\n".join([doc['content'] for doc in docs])
    enhanced_prompt = f"åŸºäºä»¥ä¸‹çŸ¥è¯†å›ç­”é—®é¢˜:\n{context}\n\né—®é¢˜: {query}"
    
    # 3. LLM å›ç­”
    async for chunk in self.llm_service.chat_stream(enhanced_prompt):
        yield chunk
```

### 4.4 æ•°æ®å­˜å‚¨æ¨¡å—

#### 4.4.1 SQLite æ•°æ®åº“è®¾è®¡

**è¡¨ç»“æ„**ï¼š
```sql
CREATE TABLE records (
    id TEXT PRIMARY KEY,
    text TEXT NOT NULL,
    metadata TEXT,           -- JSONæ ¼å¼å…ƒæ•°æ®
    app_type TEXT,           -- åº”ç”¨ç±»å‹ (voice-note, smart-chat, etc.)
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_app_type ON records(app_type);
CREATE INDEX idx_created_at ON records(created_at DESC);
```

**å…ƒæ•°æ®ç»“æ„**ï¼š
```json
{
  "blocks": [
    {
      "id": "block-xxx",
      "type": "note-info",
      "noteInfo": {
        "title": "ä¼šè®®çºªè¦",
        "type": "ä¼šè®®",
        "relatedPeople": "å¼ ä¸‰, æå››",
        "location": "ä¼šè®®å®¤A",
        "startTime": "2026-01-03 10:00:00",
        "endTime": "2026-01-03 11:30:00"
      }
    },
    {
      "id": "block-yyy",
      "type": "paragraph",
      "content": "ä¼šè®®å†…å®¹...",
      "startTime": 1704254400000,
      "endTime": 1704254410000
    }
  ],
  "language": "zh-CN",
  "provider": "volcano",
  "input_method": "voice",
  "app_type": "voice-note"
}
```

#### 4.4.2 å­˜å‚¨æä¾›å•†æ¨¡å¼

```python
class StorageProvider(ABC):
    """å­˜å‚¨æä¾›å•†åŸºç±»"""
    
    @abstractmethod
    def save_record(self, text: str, metadata: Dict) -> str:
        """ä¿å­˜è®°å½•"""
        pass
    
    @abstractmethod
    def get_record(self, record_id: str) -> Optional[Dict]:
        """è·å–è®°å½•"""
        pass
    
    @abstractmethod
    def list_records(self, limit: int, offset: int) -> List[Dict]:
        """åˆ—å‡ºè®°å½•"""
        pass
```

æ˜“äºæ‰©å±•åˆ°å…¶ä»–å­˜å‚¨åç«¯ï¼ˆPostgreSQLã€MongoDB ç­‰ï¼‰ã€‚

---

## 5. æ•°æ®æµä¸é€šä¿¡

### 5.1 HTTP REST API

#### 5.1.1 API ç«¯ç‚¹åˆ†ç±»

**å½•éŸ³æ§åˆ¶ç±»**ï¼š
```
POST /api/recording/start    - å¼€å§‹å½•éŸ³
POST /api/recording/stop     - åœæ­¢å½•éŸ³
POST /api/recording/pause    - æš‚åœå½•éŸ³
POST /api/recording/resume   - æ¢å¤å½•éŸ³
```

**LLM å¯¹è¯ç±»**ï¼š
```
POST /api/llm/chat           - LLM å¯¹è¯ï¼ˆæµå¼ï¼‰
POST /api/smartchat/chat     - æ™ºèƒ½åŠ©æ‰‹å¯¹è¯ï¼ˆæ”¯æŒ RAGï¼‰
POST /api/zen/chat           - ç¦…å¯¹è¯
POST /api/summary/generate   - ç”Ÿæˆæ‘˜è¦
```

**çŸ¥è¯†åº“ç±»**ï¼š
```
POST   /api/knowledge/upload  - ä¸Šä¼ æ–‡æ¡£
GET    /api/knowledge/files   - è·å–æ–‡æ¡£åˆ—è¡¨
GET    /api/knowledge/file/{filename} - è·å–æ–‡æ¡£å†…å®¹
DELETE /api/knowledge/file/{filename} - åˆ é™¤æ–‡æ¡£
POST   /api/knowledge/query   - æŸ¥è¯¢çŸ¥è¯†åº“
```

**å†å²è®°å½•ç±»**ï¼š
```
GET    /api/records          - è·å–å†å²è®°å½•åˆ—è¡¨
GET    /api/records/{id}     - è·å–å•æ¡è®°å½•
DELETE /api/records/{id}     - åˆ é™¤å•æ¡è®°å½•
POST   /api/records/delete   - æ‰¹é‡åˆ é™¤è®°å½•
POST   /api/text/save        - ä¿å­˜æ–‡æœ¬è®°å½•
```

**ç³»ç»Ÿç±»**ï¼š
```
GET    /api/status           - ç³»ç»ŸçŠ¶æ€
GET    /api/audio/devices    - éŸ³é¢‘è®¾å¤‡åˆ—è¡¨
POST   /api/audio/set_device - è®¾ç½®éŸ³é¢‘è®¾å¤‡
```

#### 5.1.2 è¯·æ±‚/å“åº”æ ¼å¼

**ç»Ÿä¸€å“åº”æ ¼å¼**ï¼š
```json
{
  "success": true,
  "message": "æ“ä½œæˆåŠŸ",
  "data": {},
  "error": null  // é”™è¯¯æ—¶åŒ…å« SystemErrorInfo å¯¹è±¡
}
```

**SystemErrorInfo ç»“æ„**ï¼š
```json
{
  "code": 2001,
  "category": "AUDIO",
  "message": "éŸ³é¢‘è®¾å¤‡é”™è¯¯",
  "user_message": "æœªæ‰¾åˆ°å¯ç”¨çš„éŸ³é¢‘è¾“å…¥è®¾å¤‡",
  "suggestion": "1. æ£€æŸ¥éº¦å…‹é£è¿æ¥\n2. ç¡®è®¤ç³»ç»Ÿæƒé™\n3. é‡å¯åº”ç”¨",
  "technical_info": "PortAudio error: -9996"
}
```

### 5.2 WebSocket å®æ—¶é€šä¿¡

#### 5.2.1 è¿æ¥ç®¡ç†

**å•è¿æ¥æ¨¡å¼**ï¼š
- åŒä¸€æ—¶é—´åªç»´æŠ¤ä¸€ä¸ª WebSocket è¿æ¥
- è‡ªåŠ¨æ–­çº¿é‡è¿ï¼ˆ3 ç§’å»¶è¿Ÿï¼‰
- å¿ƒè·³æ£€æµ‹ï¼ˆ5 ç§’é—´éš”ï¼‰

```typescript
// å‰ç«¯è¿æ¥ç®¡ç†
const connectWebSocket = () => {
  const ws = new WebSocket(WS_URL);
  
  ws.onopen = () => {
    console.log('[WebSocket] è¿æ¥æˆåŠŸ');
  };
  
  ws.onmessage = (event) => {
    const data = JSON.parse(event.data);
    handleWebSocketMessage(data);
  };
  
  ws.onclose = () => {
    console.log('[WebSocket] è¿æ¥æ–­å¼€ï¼Œ3ç§’åé‡è¿...');
    setTimeout(connectWebSocket, 3000);
  };
};
```

#### 5.2.2 æ¶ˆæ¯ç±»å‹

**ASR æ¶ˆæ¯**ï¼š
```json
{
  "type": "text_update",
  "text": "è¿™æ˜¯ä¸­é—´ç»“æœ",
  "app_id": "voice-note",
  "timestamp": 1704254400
}

{
  "type": "text_final",
  "text": "è¿™æ˜¯ç¡®å®šçš„å®Œæ•´å¥å­",
  "start_time": 1704254400,
  "end_time": 1704254410,
  "app_id": "voice-note"
}

{
  "type": "state_change",
  "state": "recording",  // idle, recording, stopping
  "app_id": "voice-note"
}
```

**LLM æ¶ˆæ¯**ï¼š
```json
{
  "type": "llm_chunk",
  "chunk": "è¿™æ˜¯ä¸€ä¸ª",
  "done": false
}

{
  "type": "llm_chunk",
  "chunk": "",
  "done": true
}
```

**é”™è¯¯æ¶ˆæ¯**ï¼š
```json
{
  "type": "error",
  "error": {
    "code": 1001,
    "message": "ASR å¯åŠ¨å¤±è´¥",
    "user_message": "è¯­éŸ³è¯†åˆ«æœåŠ¡å¯åŠ¨å¤±è´¥",
    "suggestion": "è¯·æ£€æŸ¥ ASR é…ç½®"
  }
}
```

### 5.3 éŸ³é¢‘æ•°æ®æµ

#### 5.3.1 å®Œæ•´æµç¨‹

```
[1] ç”¨æˆ·ç‚¹å‡»"å¯åŠ¨ ASR"
     â†“
[2] å‰ç«¯å‘é€ POST /api/recording/start
     â†“
[3] VoiceService.start_recording()
     â†“
[4] AudioRecorder.start_recording()
     â†“
[5] sounddevice å¼€å§‹é‡‡é›†éŸ³é¢‘ (16kHz, å•å£°é“)
     â†“
[6] å›è°ƒå‡½æ•°æ¥æ”¶éŸ³é¢‘å— (1024 samples)
     â†“
[7] AudioASRGateway.feed_audio()
     â†“
[8] VAD æ£€æµ‹ â†’ è¯­éŸ³? (å¯é€‰)
     â†“ æ˜¯
[9] ç¼“å†²ç®¡ç† (æ¸…ç†æ—§æ•°æ®)
     â†“
[10] è§¦å‘ on_speech_start â†’ ASR Provider å¯åŠ¨ WebSocket
     â†“
[11] éŸ³é¢‘æ•°æ®é€šè¿‡ WebSocket å‘é€åˆ°ç«å±±å¼•æ“
     â†“
[12] ç«å±±å¼•æ“è¿”å›è¯†åˆ«ç»“æœ (text_update / text_final)
     â†“
[13] VoiceService æ¥æ”¶ç»“æœï¼Œè§¦å‘å›è°ƒ
     â†“
[14] åç«¯é€šè¿‡ WebSocket å¹¿æ’­åˆ°å‰ç«¯
     â†“
[15] å‰ç«¯ App.tsx æ¥æ”¶æ¶ˆæ¯
     â†“
[16] æ›´æ–° BlockEditorï¼Œå®æ—¶æ˜¾ç¤ºæ–‡æœ¬
```

#### 5.3.2 æ€§èƒ½ä¼˜åŒ–

**1. éŸ³é¢‘é‡‡æ ·ç‡**ï¼š
- ä½¿ç”¨ 16kHz è€Œé 44.1kHz
- å‡å°‘ 60% çš„æ•°æ®é‡

**2. VAD è¿‡æ»¤**ï¼š
- è‡ªåŠ¨ä¸¢å¼ƒé™éŸ³ç‰‡æ®µ
- èŠ‚çº¦ 40-60% çš„ ASR æˆæœ¬

**3. ç¼“å†²ç®¡ç†**ï¼š
- é»˜è®¤ä¿ç•™ 60 ç§’éŸ³é¢‘
- è‡ªåŠ¨æ¸…ç†æ—§æ•°æ®ï¼Œé˜²æ­¢å†…å­˜ç´¯ç§¯

**4. å¼‚æ­¥å¤„ç†**ï¼š
- ä½¿ç”¨ async/await é¿å…é˜»å¡
- éŸ³é¢‘æµå’Œè¯†åˆ«æµå¹¶è¡Œå¤„ç†

---

## 6. ä»£ç è´¨é‡åˆ†æ

### 6.1 ä»£ç è§„èŒƒ

#### 6.1.1 Python ä»£ç è§„èŒƒ

**éµå¾ª PEP 8**ï¼š
- âœ… 4 ç©ºæ ¼ç¼©è¿›
- âœ… ç±»åä½¿ç”¨ PascalCase
- âœ… å‡½æ•°/å˜é‡åä½¿ç”¨ snake_case
- âœ… å¸¸é‡ä½¿ç”¨ UPPER_SNAKE_CASE
- âœ… æ¯è¡Œä¸è¶…è¿‡ 100 å­—ç¬¦ï¼ˆé…ç½®æ–‡ä»¶é™¤å¤–ï¼‰

**ç±»å‹æ³¨è§£**ï¼š
```python
def start_recording(self, app_id: str = None) -> bool:
    """å¼€å§‹å½•éŸ³
    
    Args:
        app_id: åº”ç”¨ID
    
    Returns:
        æ˜¯å¦æˆåŠŸå¯åŠ¨
    """
    pass
```

**æ–‡æ¡£å­—ç¬¦ä¸²**ï¼š
- âœ… æ‰€æœ‰å…¬å…±å‡½æ•°éƒ½æœ‰æ–‡æ¡£å­—ç¬¦ä¸²
- âœ… ä½¿ç”¨ Google é£æ ¼
- âœ… åŒ…å« Argsã€Returnsã€Raises

#### 6.1.2 TypeScript ä»£ç è§„èŒƒ

**å‘½åè§„èŒƒ**ï¼š
- âœ… ç»„ä»¶æ–‡ä»¶ä½¿ç”¨ PascalCase (`VoiceNote.tsx`)
- âœ… å‡½æ•°ä½¿ç”¨ camelCase (`handleAsrStart`)
- âœ… ç±»å‹/æ¥å£ä½¿ç”¨ PascalCase (`VoiceNoteProps`)
- âœ… å¸¸é‡ä½¿ç”¨ UPPER_SNAKE_CASE (`API_BASE_URL`)
- âœ… å¸ƒå°”å˜é‡ä½¿ç”¨ is/has/should å‰ç¼€ (`isConnected`)

**ç±»å‹å®‰å…¨**ï¼š
```typescript
interface VoiceNoteProps {
  text: string;
  onTextChange: (text: string) => void;
  asrState: 'idle' | 'recording' | 'stopping';
  onAsrStart?: () => void;
  apiConnected: boolean;
}
```

**React Hooks ä½¿ç”¨**ï¼š
- âœ… å‡½æ•°ç»„ä»¶ä¼˜å…ˆ
- âœ… åˆç†ä½¿ç”¨ useStateã€useEffectã€useCallback
- âœ… é¿å…è¿‡åº¦æ¸²æŸ“ï¼ˆä½¿ç”¨ React.memoï¼‰

### 6.2 ä»£ç å¤æ‚åº¦

#### 6.2.1 å…³é”®æŒ‡æ ‡

| æ–‡ä»¶ | è¡Œæ•° | å‡½æ•°æ•° | å¤æ‚åº¦è¯„ä¼° |
|------|------|--------|-----------|
| `api/server.py` | 1,739 | 50+ | ä¸­ç­‰ |
| `services/voice_service.py` | 554 | 30+ | ä¸­ç­‰ |
| `App.tsx` | 884 | 40+ | è¾ƒé«˜ |
| `BlockEditor.tsx` | 1,119 | 50+ | è¾ƒé«˜ |

**å¤æ‚åº¦è¾ƒé«˜çš„åŸå› **ï¼š
- App.tsxï¼šé›†ä¸­ç®¡ç†å¤šä¸ªåº”ç”¨çš„çŠ¶æ€
- BlockEditor.tsxï¼šå¤æ‚çš„å¯Œæ–‡æœ¬ç¼–è¾‘é€»è¾‘

**æ”¹è¿›å»ºè®®**ï¼š
- å°† App.tsx æ‹†åˆ†ä¸ºå¤šä¸ª Context
- å°† BlockEditor æ‹†åˆ†ä¸ºæ›´å°çš„å­ç»„ä»¶

#### 6.2.2 ä¾èµ–å…³ç³»

**åç«¯æ¨¡å—ä¾èµ–**ï¼š
```
api/server.py
  â†“
services/
  â”œâ”€â”€ voice_service.py â†’ providers/asr/
  â”œâ”€â”€ llm_service.py â†’ providers/llm/
  â””â”€â”€ knowledge_service.py â†’ ChromaDB
```

**å‰ç«¯ç»„ä»¶ä¾èµ–**ï¼š
```
App.tsx
  â†“
components/apps/
  â”œâ”€â”€ VoiceNote â†’ BlockEditor
  â”œâ”€â”€ SmartChat
  â”œâ”€â”€ VoiceZen
  â””â”€â”€ KnowledgeBase
```

**ä¾èµ–è€¦åˆåº¦è¯„ä¼°**ï¼š
- âœ… åç«¯æ¨¡å—ä½è€¦åˆï¼Œæ¥å£æ¸…æ™°
- âš ï¸  å‰ç«¯ App.tsx ä¸å„åº”ç”¨è€¦åˆè¾ƒé«˜
- âœ… å…±äº«ç»„ä»¶å¤ç”¨è‰¯å¥½

### 6.3 æ³¨é‡Šå®Œæ•´åº¦

#### 6.3.1 æ³¨é‡Šè¦†ç›–ç‡

**Python ä»£ç **ï¼š
- æ¨¡å—çº§æ³¨é‡Šï¼šâœ… 100%
- ç±»çº§æ³¨é‡Šï¼šâœ… 100%
- å‡½æ•°æ–‡æ¡£å­—ç¬¦ä¸²ï¼šâœ… ~95%
- å…³é”®ä»£ç è¡Œæ³¨é‡Šï¼šâœ… ~80%

**TypeScript ä»£ç **ï¼š
- ç»„ä»¶çº§æ³¨é‡Šï¼šâœ… ~90%
- æ¥å£/ç±»å‹æ³¨é‡Šï¼šâœ… ~85%
- å…³é”®é€»è¾‘æ³¨é‡Šï¼šâœ… ~75%

#### 6.3.2 æ³¨é‡Šè´¨é‡

**ä¼˜ç§€ç¤ºä¾‹**ï¼š
```python
def start_recording(self, app_id: str = None) -> bool:
    """
    å¼€å§‹å½•éŸ³ï¼ˆæµå¼è¯†åˆ«ï¼‰
    
    æ–°æ¶æ„æµç¨‹ï¼š
    1. Audio å…ˆå¯åŠ¨ï¼ˆä¿è¯ç¼“å†²ï¼‰
    2. è®¾ç½® AudioASRGateway å›è°ƒ
    3. AudioASRGateway æ ¹æ®é…ç½®å†³å®šä½•æ—¶å¯åŠ¨ ASR
    
    Args:
        app_id: åº”ç”¨ID ('voice-note', 'voice-chat', 'smart-chat' ç­‰)
    
    Returns:
        æ˜¯å¦æˆåŠŸå¯åŠ¨
    """
```

**éœ€æ”¹è¿›çš„åœ°æ–¹**ï¼š
- éƒ¨åˆ†å¤æ‚ç®—æ³•ç¼ºå°‘æ³¨é‡Š
- ä¸€äº›ä¸šåŠ¡é€»è¾‘å‡è®¾æ²¡æœ‰æ–‡æ¡£åŒ–

### 6.4 é”™è¯¯å¤„ç†

#### 6.4.1 ç»“æ„åŒ–é”™è¯¯ç³»ç»Ÿ

**SystemError æšä¸¾**ï¼š
```python
class ErrorCategory(str, Enum):
    """é”™è¯¯ç±»åˆ«"""
    NETWORK = "NETWORK"
    AUDIO = "AUDIO"
    ASR = "ASR"
    LLM = "LLM"
    STORAGE = "STORAGE"
    CONFIG = "CONFIG"
    UNKNOWN = "UNKNOWN"

class ErrorCodes:
    """é”™è¯¯ä»£ç å®šä¹‰"""
    # ç½‘ç»œé”™è¯¯ (1000-1999)
    NETWORK_UNREACHABLE = 1000
    API_SERVER_UNAVAILABLE = 1001
    WEBSOCKET_CONNECTION_FAILED = 1002
    
    # éŸ³é¢‘é”™è¯¯ (2000-2999)
    AUDIO_DEVICE_NOT_FOUND = 2000
    AUDIO_DEVICE_ERROR = 2001
    ...
```

**SystemErrorInfo ç±»**ï¼š
```python
@dataclass
class SystemErrorInfo:
    """ç³»ç»Ÿé”™è¯¯ä¿¡æ¯"""
    code: int
    category: ErrorCategory
    message: str                    # æŠ€æœ¯æ¶ˆæ¯ï¼ˆæ—¥å¿—ç”¨ï¼‰
    user_message: str               # ç”¨æˆ·å‹å¥½æ¶ˆæ¯
    suggestion: str = ""            # è§£å†³å»ºè®®
    technical_info: str = ""        # æŠ€æœ¯è¯¦æƒ…
```

#### 6.4.2 é”™è¯¯ä¼ æ’­

**åç«¯**ï¼š
```python
try:
    result = await some_operation()
except Exception as e:
    error_info = SystemErrorInfo(
        code=ErrorCodes.ASR_START_FAILED,
        category=ErrorCategory.ASR,
        message="ASRå¯åŠ¨å¤±è´¥",
        user_message="è¯­éŸ³è¯†åˆ«æœåŠ¡å¯åŠ¨å¤±è´¥",
        suggestion="è¯·æ£€æŸ¥ ASR é…ç½®å’Œç½‘ç»œè¿æ¥",
        technical_info=str(e)
    )
    return {"success": False, "error": error_info.to_dict()}
```

**å‰ç«¯**ï¼š
```typescript
if (data.error && data.error.code) {
  setSystemError(data.error as SystemErrorInfo);
}
```

#### 6.4.3 ç”¨æˆ·åé¦ˆ

**é”™è¯¯æ¨ªå¹…ï¼ˆé˜»å¡æ€§é”™è¯¯ï¼‰**ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âš ï¸ è¯­éŸ³è¯†åˆ«æœåŠ¡å¯åŠ¨å¤±è´¥                      â”‚
â”‚                                              â”‚
â”‚ æœªæ‰¾åˆ°å¯ç”¨çš„éŸ³é¢‘è¾“å…¥è®¾å¤‡                      â”‚
â”‚                                              â”‚
â”‚ å»ºè®®ï¼š                                       â”‚
â”‚ 1. æ£€æŸ¥éº¦å…‹é£è¿æ¥                            â”‚
â”‚ 2. ç¡®è®¤ç³»ç»Ÿæƒé™                              â”‚
â”‚ 3. é‡å¯åº”ç”¨                                  â”‚
â”‚                                              â”‚
â”‚ [é‡è¯•] [å¿½ç•¥]                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Toast æç¤ºï¼ˆéé˜»å¡æ€§é”™è¯¯ï¼‰**ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â“˜ å·²ä¿å­˜åˆ°å†å²è®°å½•          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

(ç”±äºå†…å®¹è¿‡é•¿ï¼Œæˆ‘å°†ç»§ç»­åœ¨ä¸‹ä¸€ä¸ªæ–‡ä»¶ä¸­ç¼–å†™å‰©ä½™éƒ¨åˆ†...)

# MindVoice æŠ€æœ¯æŠ¥å‘Š (ç»­)

## 7. æ€§èƒ½ä¸ä¼˜åŒ–

### 7.1 æ€§èƒ½æŒ‡æ ‡

#### 7.1.1 å“åº”æ—¶é—´

| æ“ä½œ | ç›®æ ‡å»¶è¿Ÿ | å®é™…å»¶è¿Ÿ | çŠ¶æ€ |
|------|---------|---------|------|
| ASR å¯åŠ¨ | < 1s | ~500ms | âœ… ä¼˜ç§€ |
| è¯­éŸ³è¯†åˆ«å»¶è¿Ÿ | < 1s | ~300-500ms | âœ… ä¼˜ç§€ |
| LLM é¦–å­—å»¶è¿Ÿ | < 2s | ~1-1.5s | âœ… è‰¯å¥½ |
| å†å²è®°å½•åŠ è½½ | < 500ms | ~200ms | âœ… ä¼˜ç§€ |
| çŸ¥è¯†åº“æŸ¥è¯¢ | < 1s | ~500-800ms | âœ… è‰¯å¥½ |
| åº”ç”¨åˆ‡æ¢ | < 100ms | ~50ms | âœ… ä¼˜ç§€ |

#### 7.1.2 èµ„æºå ç”¨

**å‰ç«¯ (Electron)**ï¼š
- å†…å­˜ï¼š~200-300 MBï¼ˆç©ºé—²çŠ¶æ€ï¼‰
- å†…å­˜ï¼š~300-400 MBï¼ˆå½•éŸ³çŠ¶æ€ï¼‰
- CPUï¼š< 5%ï¼ˆç©ºé—²ï¼‰ï¼Œ10-20%ï¼ˆå½•éŸ³ï¼‰
- ç£ç›˜ï¼š~150 MBï¼ˆåº”ç”¨åŒ…ä½“ç§¯ï¼‰

**åç«¯ (Python)**ï¼š
- å†…å­˜ï¼š~100-150 MBï¼ˆæ— çŸ¥è¯†åº“ï¼‰
- å†…å­˜ï¼š~250-350 MBï¼ˆå«çŸ¥è¯†åº“ï¼‰
- CPUï¼š< 5%ï¼ˆç©ºé—²ï¼‰ï¼Œ30-50%ï¼ˆASR å¤„ç†ï¼‰
- ç£ç›˜ï¼š~80 MBï¼ˆä¾èµ–åŒ…ï¼‰

#### 7.1.3 ååé‡

| æŒ‡æ ‡ | æ•°å€¼ |
|------|------|
| WebSocket å¹¶å‘è¿æ¥ | 1 ä¸ªï¼ˆå•è¿æ¥æ¨¡å¼ï¼‰ |
| HTTP API QPS | ~100 req/sï¼ˆå•å®ä¾‹ï¼‰ |
| éŸ³é¢‘é‡‡æ ·ç‡ | 16 kHzï¼ˆå•å£°é“ï¼‰ |
| éŸ³é¢‘æ•°æ®æµé‡ | ~32 KB/s |
| ASR è¯†åˆ«é€Ÿåº¦ | å®æ—¶ï¼ˆRTF < 0.5ï¼‰ |

### 7.2 æ€§èƒ½ä¼˜åŒ–å®è·µ

#### 7.2.1 å‰ç«¯ä¼˜åŒ–

**1. React æ¸²æŸ“ä¼˜åŒ–**

```typescript
// ä½¿ç”¨ React.memo é¿å…ä¸å¿…è¦çš„é‡æ¸²æŸ“
export const BlockEditor = React.memo(forwardRef<BlockEditorHandle, BlockEditorProps>(
  ({ initialContent, onContentChange, isRecording }, ref) => {
    // ç»„ä»¶é€»è¾‘
  }
));

// ä½¿ç”¨ useCallback ç¼“å­˜å›è°ƒå‡½æ•°
const handleTextChange = useCallback((newText: string) => {
  if (!isWorkSessionActive && newText.trim().length > 0) {
    onStartWork();
  }
  onTextChange(newText);
}, [isWorkSessionActive, onStartWork, onTextChange]);
```

**2. é˜²æŠ–ä¸èŠ‚æµ**

```typescript
// è‡ªåŠ¨ä¿å­˜è‰ç¨¿ï¼ˆé˜²æŠ–ï¼‰
useEffect(() => {
  if (text.trim() && isWorkSessionActive) {
    const timer = setTimeout(() => {
      localStorage.setItem('voiceNoteDraft', JSON.stringify({
        text,
        app: activeView,
        timestamp: Date.now()
      }));
    }, 3000);  // 3 ç§’é˜²æŠ–
    
    return () => clearTimeout(timer);
  }
}, [text, isWorkSessionActive, activeView]);
```

**3. è™šæ‹Ÿæ»šåŠ¨ï¼ˆå»ºè®®å®ç°ï¼‰**

å¯¹äºé•¿åˆ—è¡¨ï¼ˆå¦‚å†å²è®°å½•ï¼‰ï¼Œå»ºè®®å®ç°è™šæ‹Ÿæ»šåŠ¨ï¼š
```typescript
// ä½¿ç”¨ react-window æˆ– react-virtualized
import { FixedSizeList } from 'react-window';

<FixedSizeList
  height={600}
  itemCount={records.length}
  itemSize={100}
>
  {({ index, style }) => (
    <div style={style}>
      <RecordItem record={records[index]} />
    </div>
  )}
</FixedSizeList>
```

#### 7.2.2 åç«¯ä¼˜åŒ–

**1. å¼‚æ­¥å¤„ç†**

```python
# ä½¿ç”¨å¼‚æ­¥å‡½æ•°é¿å…é˜»å¡
@app.post("/api/recording/start")
async def start_recording(request: StartRequest):
    success = await voice_service.start_recording(request.app_id)
    return {"success": success}

# æµå¼å¤„ç†å¤§æ•°æ®
async def chat_stream(message: str) -> AsyncIterator[str]:
    async for chunk in llm_provider.chat_stream(message):
        yield chunk
```

**2. æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–**

```python
# ä½¿ç”¨ç´¢å¼•åŠ é€ŸæŸ¥è¯¢
CREATE INDEX idx_app_type ON records(app_type);
CREATE INDEX idx_created_at ON records(created_at DESC);

# åˆ†é¡µæŸ¥è¯¢ï¼Œé¿å…å…¨è¡¨æ‰«æ
def list_records(self, limit: int = 100, offset: int = 0):
    cursor.execute('''
        SELECT * FROM records
        ORDER BY created_at DESC
        LIMIT ? OFFSET ?
    ''', (limit, offset))
```

**3. ç¼“å­˜ç­–ç•¥**

```python
# LLM é…ç½®ç¼“å­˜
@lru_cache(maxsize=1)
def get_llm_config():
    return config.get('llm', {})

# çŸ¥è¯†åº“æ¨¡å‹å»¶è¿ŸåŠ è½½
async def start_background_load(self):
    """åå°åŠ è½½ Embedding æ¨¡å‹ï¼Œä¸é˜»å¡å¯åŠ¨"""
    loop = asyncio.get_running_loop()
    task = loop.create_task(self._load_model_async())
    return task
```

#### 7.2.3 ç½‘ç»œä¼˜åŒ–

**1. WebSocket å¤ç”¨**

- å•è¿æ¥æ¨¡å¼ï¼Œé¿å…å¤šè¿æ¥å¼€é”€
- å¿ƒè·³ä¿æ´»ï¼ˆ5ç§’é—´éš”ï¼‰
- è‡ªåŠ¨é‡è¿ï¼ˆ3ç§’å»¶è¿Ÿï¼‰

**2. æ•°æ®å‹ç¼©**

```python
# éŸ³é¢‘æ•°æ®å·²ä½¿ç”¨ 16kHz å•å£°é“ï¼ˆç›¸æ¯” 44.1kHz ç«‹ä½“å£°å‡å°‘ 70% æ•°æ®é‡ï¼‰
# HTTP å“åº”å¼€å¯ gzip å‹ç¼©
app.add_middleware(GZipMiddleware, minimum_size=1000)
```

**3. VAD èŠ‚çº¦æˆæœ¬**

- å¯ç”¨ VAD è‡ªåŠ¨è¿‡æ»¤é™éŸ³
- èŠ‚çº¦ 40-60% çš„ ASR æˆæœ¬
- å‡å°‘ç½‘ç»œæµé‡

### 7.3 å†…å­˜ç®¡ç†

#### 7.3.1 éŸ³é¢‘ç¼“å†²åŒºç®¡ç†

**é—®é¢˜**ï¼šé•¿æ—¶é—´å½•éŸ³å¯¼è‡´å†…å­˜æŒç»­ç´¯ç§¯ã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼š
```python
class AudioASRGateway:
    def _cleanup_old_audio(self):
        """æ¸…ç†æ—§çš„éŸ³é¢‘æ•°æ®"""
        if self.max_buffer_seconds > 0:
            max_samples = int(self.rate * self.max_buffer_seconds)
            if len(self.audio_buffer) > max_samples:
                # ä¿ç•™æœ€è¿‘çš„ 50% æ•°æ®
                keep_samples = max_samples // 2
                self.audio_buffer = self.audio_buffer[-keep_samples:]
                logger.debug(f"æ¸…ç†éŸ³é¢‘ç¼“å†²åŒºï¼Œä¿ç•™ {keep_samples} ä¸ªæ ·æœ¬")
```

**æ•ˆæœ**ï¼š
- é»˜è®¤ä¿ç•™ 60 ç§’éŸ³é¢‘ï¼ˆ~1.92 MBï¼‰
- æ”¯æŒæ— é™æ—¶é•¿å½•éŸ³
- ä¸å½±å“å®æ—¶è¯†åˆ«

#### 7.3.2 React å†…å­˜æ³„æ¼é˜²æŠ¤

```typescript
useEffect(() => {
  const ws = new WebSocket(WS_URL);
  
  return () => {
    // ç»„ä»¶å¸è½½æ—¶æ¸…ç† WebSocket
    if (ws.readyState === WebSocket.OPEN) {
      ws.close();
    }
  };
}, []);

useEffect(() => {
  const timer = setInterval(() => {
    checkApiConnection();
  }, 5000);
  
  return () => {
    // ç»„ä»¶å¸è½½æ—¶æ¸…ç†å®šæ—¶å™¨
    clearInterval(timer);
  };
}, []);
```

### 7.4 æ€§èƒ½ç›‘æ§å»ºè®®

#### 7.4.1 å‰ç«¯ç›‘æ§

**å»ºè®®æ·»åŠ çš„æŒ‡æ ‡**ï¼š
```typescript
// é¡µé¢åŠ è½½æ—¶é—´
performance.mark('app-start');
performance.mark('app-ready');
const loadTime = performance.measure('load-time', 'app-start', 'app-ready');

// ASR å»¶è¿Ÿç›‘æ§
const asrStartTime = Date.now();
onAsrFirstResult = () => {
  const latency = Date.now() - asrStartTime;
  console.log(`ASR é¦–å­—å»¶è¿Ÿ: ${latency}ms`);
};

// å†…å­˜ç›‘æ§
if (performance.memory) {
  console.log('Used JS Heap:', performance.memory.usedJSHeapSize / 1024 / 1024, 'MB');
}
```

#### 7.4.2 åç«¯ç›‘æ§

**å»ºè®®æ·»åŠ çš„æŒ‡æ ‡**ï¼š
```python
import time
from functools import wraps

def monitor_performance(func):
    """æ€§èƒ½ç›‘æ§è£…é¥°å™¨"""
    @wraps(func)
    async def wrapper(*args, **kwargs):
        start = time.time()
        try:
            result = await func(*args, **kwargs)
            elapsed = time.time() - start
            logger.info(f"{func.__name__} è€—æ—¶: {elapsed:.3f}s")
            return result
        except Exception as e:
            elapsed = time.time() - start
            logger.error(f"{func.__name__} å¤±è´¥ (è€—æ—¶: {elapsed:.3f}s): {e}")
            raise
    return wrapper

@monitor_performance
async def start_recording(self, app_id: str):
    # å‡½æ•°é€»è¾‘
    pass
```

---

## 8. å®‰å…¨æ€§åˆ†æ

### 8.1 å½“å‰å®‰å…¨æªæ–½

#### 8.1.1 API å®‰å…¨

**CORS é…ç½®**ï¼š
```python
app.add_middleware(
    CORSMiddleware,
    allow_origins=["*"],  # å¼€å‘ç¯å¢ƒ
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)
```

âš ï¸ **ç”Ÿäº§ç¯å¢ƒå»ºè®®**ï¼šé™åˆ¶ `allow_origins` ä¸ºç‰¹å®šåŸŸåã€‚

**è¾“å…¥éªŒè¯**ï¼š
```python
class SaveTextRequest(BaseModel):
    """ä½¿ç”¨ Pydantic è‡ªåŠ¨éªŒè¯è¾“å…¥"""
    text: str = Field(..., min_length=1, max_length=1000000)
    app_type: str = Field(..., regex="^(voice-note|voice-chat|voice-zen)$")
    blocks: Optional[list] = None
```

#### 8.1.2 é…ç½®å®‰å…¨

**æ•æ„Ÿä¿¡æ¯ä¿æŠ¤**ï¼š
```yaml
# config.yml ä¸æäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶
# .gitignore
config.yml
*.key
*.pem
```

**é…ç½®æ–‡ä»¶æƒé™**ï¼š
```bash
# å»ºè®®è®¾ç½®æ–‡ä»¶æƒé™
chmod 600 config.yml
```

#### 8.1.3 æ•°æ®å®‰å…¨

**SQL æ³¨å…¥é˜²æŠ¤**ï¼š
```python
# ä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢
cursor.execute('''
    SELECT * FROM records WHERE id = ?
''', (record_id,))
```

**XSS é˜²æŠ¤**ï¼š
```typescript
// React é»˜è®¤è½¬ä¹‰è¾“å‡ºï¼Œé˜²æ­¢ XSS
<div>{text}</div>

// å¦‚éœ€æ¸²æŸ“ HTMLï¼Œä½¿ç”¨ DOMPurify
import DOMPurify from 'dompurify';
<div dangerouslySetInnerHTML={{ __html: DOMPurify.sanitize(html) }} />
```

### 8.2 å®‰å…¨é£é™©è¯„ä¼°

| é£é™©ç±»åˆ« | é£é™©ç­‰çº§ | å½“å‰æªæ–½ | æ”¹è¿›å»ºè®® |
|---------|---------|---------|---------|
| API æœªæˆæƒè®¿é—® | ğŸŸ¡ ä¸­ç­‰ | æœ¬åœ°æœåŠ¡ | æ·»åŠ  API å¯†é’¥æˆ– JWT |
| é…ç½®æ–‡ä»¶æ³„éœ² | ğŸŸ  è¾ƒé«˜ | .gitignore | ä½¿ç”¨ç¯å¢ƒå˜é‡æˆ–å¯†é’¥ç®¡ç†æœåŠ¡ |
| SQL æ³¨å…¥ | ğŸŸ¢ ä½ | å‚æ•°åŒ–æŸ¥è¯¢ | ç»§ç»­ä¿æŒ |
| XSS æ”»å‡» | ğŸŸ¢ ä½ | React è‡ªåŠ¨è½¬ä¹‰ | å®¡æŸ¥ dangerouslySetInnerHTML |
| WebSocket åŠ«æŒ | ğŸŸ¡ ä¸­ç­‰ | æœ¬åœ°è¿æ¥ | æ·»åŠ  Token éªŒè¯ |
| éŸ³é¢‘æ•°æ®æ³„éœ² | ğŸŸ¡ ä¸­ç­‰ | æœ¬åœ°å¤„ç† | ä¸ä¸Šä¼ åˆ°å¤–éƒ¨æœåŠ¡ |
| LLM API å¯†é’¥æ³„éœ² | ğŸŸ  è¾ƒé«˜ | é…ç½®æ–‡ä»¶ | ä½¿ç”¨å¯†é’¥ç®¡ç†æœåŠ¡ |

### 8.3 å®‰å…¨æ”¹è¿›å»ºè®®

#### 8.3.1 èº«ä»½è®¤è¯

**å»ºè®®å®ç° API å¯†é’¥æœºåˆ¶**ï¼š
```python
# ç”Ÿæˆ API å¯†é’¥
import secrets
API_KEY = secrets.token_urlsafe(32)

# éªŒè¯ä¸­é—´ä»¶
@app.middleware("http")
async def verify_api_key(request: Request, call_next):
    api_key = request.headers.get("X-API-Key")
    if api_key != config.get("api.key"):
        return JSONResponse(
            status_code=401,
            content={"error": "Unauthorized"}
        )
    return await call_next(request)
```

#### 8.3.2 HTTPS æ”¯æŒ

**å»ºè®®æ·»åŠ  SSL/TLS æ”¯æŒ**ï¼š
```python
# ä½¿ç”¨è‡ªç­¾åè¯ä¹¦æˆ– Let's Encrypt
uvicorn.run(
    app,
    host="127.0.0.1",
    port=8765,
    ssl_keyfile="./certs/key.pem",
    ssl_certfile="./certs/cert.pem"
)
```

#### 8.3.3 æ—¥å¿—è„±æ•

**é¿å…è®°å½•æ•æ„Ÿä¿¡æ¯**ï¼š
```python
# ä¸è¦è®°å½•å®Œæ•´çš„ API å¯†é’¥
logger.info(f"ä½¿ç”¨ LLM: {model}, API Key: {api_key[:8]}***")

# ä¸è¦è®°å½•ç”¨æˆ·è¾“å…¥çš„å®Œæ•´å†…å®¹ï¼ˆä»…è®°å½•é•¿åº¦ï¼‰
logger.info(f"ä¿å­˜æ–‡æœ¬è®°å½•ï¼Œé•¿åº¦: {len(text)} å­—ç¬¦")
```

#### 8.3.4 ä¾èµ–å®‰å…¨

**å®šæœŸæ›´æ–°ä¾èµ–**ï¼š
```bash
# æ£€æŸ¥ä¾èµ–å®‰å…¨æ¼æ´
pip install safety
safety check

# æ›´æ–°ä¾èµ–
pip install --upgrade -r requirements.txt
```

---

## 9. éƒ¨ç½²ä¸è¿ç»´

### 9.1 å¼€å‘ç¯å¢ƒ

#### 9.1.1 ç¯å¢ƒè¦æ±‚

**è½¯ä»¶è¦æ±‚**ï¼š
- Python 3.9+
- Node.js 18+
- npm æˆ– yarn
- Git

**æ“ä½œç³»ç»Ÿ**ï¼š
- macOS 10.15+ï¼ˆæ¨èï¼‰
- Linux (Ubuntu 20.04+, Debian 11+)
- Windows 10+ (éœ€è¦ WSL2)

#### 9.1.2 å¿«é€Ÿå¯åŠ¨

```bash
# 1. å…‹éš†é¡¹ç›®
git clone <repository-url>
cd è¯­éŸ³æ¡Œé¢åŠ©æ‰‹

# 2. å®‰è£…åç«¯ä¾èµ–
python3 -m venv venv
source venv/bin/activate
pip install -r requirements.txt

# 3. å®‰è£…å‰ç«¯ä¾èµ–
cd electron-app
npm install
cd ..

# 4. é…ç½®æœåŠ¡
cp config.yml.example config.yml
# ç¼–è¾‘ config.ymlï¼Œå¡«å…¥ ASR å’Œ LLM é…ç½®

# 5. å¯åŠ¨åº”ç”¨
./quick_start.sh
```

### 9.2 ç”Ÿäº§éƒ¨ç½²

#### 9.2.1 åç«¯éƒ¨ç½²

**ä½¿ç”¨ Supervisor ç®¡ç†è¿›ç¨‹**ï¼š
```ini
[program:mindvoice-api]
command=/path/to/venv/bin/python api_server.py
directory=/path/to/project
user=mindvoice
autostart=true
autorestart=true
stderr_logfile=/var/log/mindvoice/api.err.log
stdout_logfile=/var/log/mindvoice/api.out.log
environment=PYTHONPATH="/path/to/project"
```

**ä½¿ç”¨ systemd**ï¼š
```ini
[Unit]
Description=MindVoice API Server
After=network.target

[Service]
Type=simple
User=mindvoice
WorkingDirectory=/path/to/project
Environment="PATH=/path/to/venv/bin"
ExecStart=/path/to/venv/bin/python api_server.py
Restart=on-failure

[Install]
WantedBy=multi-user.target
```

#### 9.2.2 å‰ç«¯æ‰“åŒ…

**macOS åº”ç”¨æ‰“åŒ…**ï¼š
```bash
cd electron-app
npm run build
npm run dist

# ç”Ÿæˆ .app å’Œ .dmg
# è¾“å‡ºç›®å½•: electron-app/release/
```

**Windows åº”ç”¨æ‰“åŒ…**ï¼š
```bash
# éœ€è¦åœ¨ Windows ç¯å¢ƒæˆ–ä½¿ç”¨äº¤å‰ç¼–è¯‘
npm run dist
# ç”Ÿæˆ .exe å’Œ NSIS å®‰è£…åŒ…
```

**Linux åº”ç”¨æ‰“åŒ…**ï¼š
```bash
npm run dist
# ç”Ÿæˆ AppImage å’Œ .deb
```

#### 9.2.3 Docker éƒ¨ç½²ï¼ˆå»ºè®®å®ç°ï¼‰

**Dockerfile (åç«¯)**ï¼š
```dockerfile
FROM python:3.9-slim

WORKDIR /app

# å®‰è£…ä¾èµ–
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

# å¤åˆ¶ä»£ç 
COPY src/ src/
COPY api_server.py .

# æš´éœ²ç«¯å£
EXPOSE 8765

# å¯åŠ¨æœåŠ¡
CMD ["python", "api_server.py"]
```

**docker-compose.yml**ï¼š
```yaml
version: '3.8'
services:
  mindvoice-api:
    build: .
    ports:
      - "8765:8765"
    volumes:
      - ./config.yml:/app/config.yml:ro
      - ./data:/app/data
    environment:
      - PYTHONUNBUFFERED=1
    restart: unless-stopped
```

### 9.3 æ—¥å¿—ç®¡ç†

#### 9.3.1 æ—¥å¿—çº§åˆ«

```python
# å¼€å‘ç¯å¢ƒï¼šDEBUG
# ç”Ÿäº§ç¯å¢ƒï¼šINFO
# é”™è¯¯è¿½è¸ªï¼šERROR

logger.debug("è°ƒè¯•ä¿¡æ¯")
logger.info("æ™®é€šä¿¡æ¯")
logger.warning("è­¦å‘Šä¿¡æ¯")
logger.error("é”™è¯¯ä¿¡æ¯")
```

#### 9.3.2 æ—¥å¿—è½®è½¬

**ä½¿ç”¨ logging.handlers.RotatingFileHandler**ï¼š
```python
from logging.handlers import RotatingFileHandler

handler = RotatingFileHandler(
    'logs/mindvoice.log',
    maxBytes=10*1024*1024,  # 10 MB
    backupCount=5           # ä¿ç•™ 5 ä¸ªå¤‡ä»½
)
```

#### 9.3.3 æ—¥å¿—èšåˆ

**å»ºè®®ä½¿ç”¨ ELK æˆ– Loki**ï¼š
```yaml
# filebeat.yml
filebeat.inputs:
  - type: log
    enabled: true
    paths:
      - /path/to/logs/*.log
    
output.elasticsearch:
  hosts: ["localhost:9200"]
```

### 9.4 ç›‘æ§å‘Šè­¦

#### 9.4.1 å¥åº·æ£€æŸ¥

**å®ç°å¥åº·æ£€æŸ¥ç«¯ç‚¹**ï¼š
```python
@app.get("/health")
async def health_check():
    """å¥åº·æ£€æŸ¥"""
    return {
        "status": "healthy",
        "timestamp": time.time(),
        "services": {
            "voice_service": voice_service is not None,
            "llm_service": llm_service is not None,
            "knowledge_service": knowledge_service is not None
        }
    }
```

#### 9.4.2 æ€§èƒ½æŒ‡æ ‡

**å»ºè®®é›†æˆ Prometheus**ï¼š
```python
from prometheus_client import Counter, Histogram

# è¯·æ±‚è®¡æ•°
request_counter = Counter('api_requests_total', 'Total API requests', ['endpoint', 'status'])

# å“åº”æ—¶é—´
response_time = Histogram('api_response_seconds', 'API response time', ['endpoint'])

@app.middleware("http")
async def monitor_requests(request: Request, call_next):
    start = time.time()
    response = await call_next(request)
    duration = time.time() - start
    
    response_time.labels(endpoint=request.url.path).observe(duration)
    request_counter.labels(endpoint=request.url.path, status=response.status_code).inc()
    
    return response
```

#### 9.4.3 å‘Šè­¦è§„åˆ™

**å»ºè®®çš„å‘Šè­¦æ¡ä»¶**ï¼š
- API å“åº”æ—¶é—´ > 5s
- é”™è¯¯ç‡ > 5%
- å†…å­˜ä½¿ç”¨ > 80%
- ç£ç›˜ä½¿ç”¨ > 90%
- WebSocket è¿æ¥æ–­å¼€ > 3 æ¬¡/åˆ†é’Ÿ

### 9.5 å¤‡ä»½ç­–ç•¥

#### 9.5.1 æ•°æ®åº“å¤‡ä»½

```bash
#!/bin/bash
# backup_db.sh

BACKUP_DIR="/path/to/backups"
DB_FILE="/path/to/data/history.db"
TIMESTAMP=$(date +%Y%m%d_%H%M%S)

# å¤åˆ¶æ•°æ®åº“
cp "$DB_FILE" "$BACKUP_DIR/history_$TIMESTAMP.db"

# å‹ç¼©
gzip "$BACKUP_DIR/history_$TIMESTAMP.db"

# åˆ é™¤ 30 å¤©å‰çš„å¤‡ä»½
find "$BACKUP_DIR" -name "history_*.db.gz" -mtime +30 -delete
```

**å®šæ—¶å¤‡ä»½ï¼ˆcrontabï¼‰**ï¼š
```
# æ¯å¤©å‡Œæ™¨ 2 ç‚¹å¤‡ä»½
0 2 * * * /path/to/backup_db.sh
```

#### 9.5.2 é…ç½®å¤‡ä»½

```bash
# å¤‡ä»½é…ç½®æ–‡ä»¶
cp config.yml config.yml.backup.$(date +%Y%m%d)

# ç‰ˆæœ¬æ§åˆ¶ï¼ˆä½¿ç”¨ gitï¼‰
git add config.yml.example
git commit -m "Update config example"
```

---

## 10. æŠ€æœ¯å€ºåŠ¡ä¸æ”¹è¿›å»ºè®®

### 10.1 å½“å‰æŠ€æœ¯å€ºåŠ¡

#### 10.1.1 æµ‹è¯•è¦†ç›–

**ç°çŠ¶**ï¼š
- âŒ æ— è‡ªåŠ¨åŒ–æµ‹è¯•
- âŒ æ— å•å…ƒæµ‹è¯•
- âŒ æ— é›†æˆæµ‹è¯•
- âŒ æ—  E2E æµ‹è¯•

**å½±å“**ï¼š
- é‡æ„é£é™©é«˜
- éš¾ä»¥ä¿è¯ä»£ç è´¨é‡
- Bug ä¿®å¤å®¹æ˜“å¼•å…¥æ–°é—®é¢˜

**æ”¹è¿›å»ºè®®**ï¼š
```python
# æ·»åŠ  pytest å•å…ƒæµ‹è¯•
# tests/test_voice_service.py
import pytest
from src.services.voice_service import VoiceService

def test_start_recording():
    service = VoiceService(config, asr_provider)
    result = service.start_recording("voice-note")
    assert result is True

# æ·»åŠ é›†æˆæµ‹è¯•
@pytest.mark.asyncio
async def test_asr_end_to_end():
    # å¯åŠ¨ ASR
    success = await voice_service.start_recording()
    assert success
    
    # å‘é€éŸ³é¢‘
    await voice_service.send_audio(test_audio_data)
    
    # éªŒè¯è¯†åˆ«ç»“æœ
    result = await voice_service.get_result()
    assert result is not None
```

```typescript
// æ·»åŠ  React Testing Library æµ‹è¯•
// src/components/apps/VoiceNote/VoiceNote.test.tsx
import { render, screen, fireEvent } from '@testing-library/react';
import { VoiceNote } from './VoiceNote';

describe('VoiceNote', () => {
  it('should render correctly', () => {
    render(<VoiceNote {...props} />);
    expect(screen.getByText('è¯­éŸ³ç¬”è®°')).toBeInTheDocument();
  });
  
  it('should start ASR when button clicked', () => {
    const onAsrStart = jest.fn();
    render(<VoiceNote {...props} onAsrStart={onAsrStart} />);
    
    fireEvent.click(screen.getByText('å¯åŠ¨ASR'));
    expect(onAsrStart).toHaveBeenCalled();
  });
});
```

#### 10.1.2 ä»£ç å¤æ‚åº¦

**é«˜å¤æ‚åº¦æ–‡ä»¶**ï¼š
- `App.tsx` (884 è¡Œ) - çŠ¶æ€ç®¡ç†è¿‡äºé›†ä¸­
- `BlockEditor.tsx` (1,119 è¡Œ) - ç¼–è¾‘é€»è¾‘å¤æ‚
- `api/server.py` (1,739 è¡Œ) - API ç«¯ç‚¹è¿‡å¤š

**æ”¹è¿›å»ºè®®**ï¼š

1. **æ‹†åˆ† App.tsx**ï¼š
```typescript
// ä½¿ç”¨ Context åˆ†ç¦»çŠ¶æ€ç®¡ç†
export const ASRContext = createContext<ASRContextType>(null);
export const LLMContext = createContext<LLMContextType>(null);
export const HistoryContext = createContext<HistoryContextType>(null);

function App() {
  return (
    <ASRContext.Provider value={asrState}>
      <LLMContext.Provider value={llmState}>
        <HistoryContext.Provider value={historyState}>
          <AppContent />
        </HistoryContext.Provider>
      </LLMContext.Provider>
    </ASRContext.Provider>
  );
}
```

2. **æ‹†åˆ† BlockEditor**ï¼š
```typescript
// æ‹†åˆ†ä¸ºæ›´å°çš„å­ç»„ä»¶
<BlockEditor>
  <NoteInfoBlock />
  <ParagraphBlock />
  <TimelineIndicator />
  <FormatToolbar />
</BlockEditor>
```

3. **æ‹†åˆ† server.py**ï¼š
```python
# æŒ‰åŠŸèƒ½æ¨¡å—æ‹†åˆ† API
from api.routes import asr_routes, llm_routes, storage_routes

app.include_router(asr_routes.router, prefix="/api/recording")
app.include_router(llm_routes.router, prefix="/api/llm")
app.include_router(storage_routes.router, prefix="/api/records")
```

#### 10.1.3 æ–‡æ¡£ç¼ºå¤±

**ç¼ºå¤±çš„æ–‡æ¡£**ï¼š
- âŒ API æ–‡æ¡£ï¼ˆSwagger å¯è‡ªåŠ¨ç”Ÿæˆï¼Œä½†éœ€è¡¥å……è¯´æ˜ï¼‰
- âŒ ç»„ä»¶æ–‡æ¡£ï¼ˆStorybookï¼‰
- âš ï¸ æ¶æ„å†³ç­–è®°å½•ï¼ˆADRï¼‰
- âš ï¸ éƒ¨ç½²æ–‡æ¡£

**æ”¹è¿›å»ºè®®**ï¼š
```python
# è¡¥å…… API æ–‡æ¡£æ³¨é‡Š
@app.post("/api/recording/start", 
    summary="å¯åŠ¨è¯­éŸ³è¯†åˆ«",
    description="""
    å¯åŠ¨è¯­éŸ³è¯†åˆ«æœåŠ¡ï¼Œå¼€å§‹å®æ—¶è½¬å†™ã€‚
    
    **å·¥ä½œæµç¨‹**ï¼š
    1. å¯åŠ¨éŸ³é¢‘å½•åˆ¶
    2. åˆå§‹åŒ– ASR WebSocket è¿æ¥
    3. å¼€å§‹æµå¼å‘é€éŸ³é¢‘æ•°æ®
    
    **æ³¨æ„äº‹é¡¹**ï¼š
    - éœ€è¦å…ˆé…ç½® ASR æœåŠ¡
    - ç¡®ä¿éº¦å…‹é£æƒé™å·²æˆäºˆ
    - åŒä¸€æ—¶é—´åªèƒ½æœ‰ä¸€ä¸ªå½•éŸ³ä»»åŠ¡
    """,
    responses={
        200: {"description": "æˆåŠŸå¯åŠ¨"},
        400: {"description": "è¯·æ±‚å‚æ•°é”™è¯¯"},
        503: {"description": "ASR æœåŠ¡ä¸å¯ç”¨"}
    }
)
async def start_recording(request: StartRequest):
    pass
```

#### 10.1.4 ç¡¬ç¼–ç 

**é—®é¢˜ç¤ºä¾‹**ï¼š
```typescript
// electron-app/src/App.tsx
const API_BASE_URL = 'http://127.0.0.1:8765';  // ç¡¬ç¼–ç 
const WS_URL = 'ws://127.0.0.1:8765/ws';       // ç¡¬ç¼–ç 
```

**æ”¹è¿›å»ºè®®**ï¼š
```typescript
// ä½¿ç”¨ç¯å¢ƒå˜é‡
const API_BASE_URL = import.meta.env.VITE_API_BASE_URL || 'http://127.0.0.1:8765';
const WS_URL = import.meta.env.VITE_WS_URL || 'ws://127.0.0.1:8765/ws';

// .env.development
VITE_API_BASE_URL=http://127.0.0.1:8765
VITE_WS_URL=ws://127.0.0.1:8765/ws

// .env.production
VITE_API_BASE_URL=https://api.mindvoice.com
VITE_WS_URL=wss://api.mindvoice.com/ws
```

### 10.2 åŠŸèƒ½æ”¹è¿›å»ºè®®

#### 10.2.1 çŸ­æœŸæ”¹è¿›ï¼ˆ1-2 å‘¨ï¼‰

**ä¼˜å…ˆçº§ P0ï¼ˆå¿…é¡»ï¼‰**ï¼š
1. âœ… æ·»åŠ åŸºç¡€å•å…ƒæµ‹è¯•
2. âœ… è¡¥å…… API æ–‡æ¡£
3. âœ… ä¿®å¤å·²çŸ¥ Bug

**ä¼˜å…ˆçº§ P1ï¼ˆé‡è¦ï¼‰**ï¼š
1. â³ å®ç°å…¨å±€å¿«æ·é”®ï¼ˆå¦‚ Cmd+Space å”¤é†’ï¼‰
2. â³ æ·»åŠ éŸ³é¢‘è®¾å¤‡é€‰æ‹©ç•Œé¢
3. â³ å®ç°å†å²è®°å½•æœç´¢åŠŸèƒ½
4. â³ ä¼˜åŒ– App.tsx çŠ¶æ€ç®¡ç†

#### 10.2.2 ä¸­æœŸæ”¹è¿›ï¼ˆ1-2 æœˆï¼‰

**ä¼˜å…ˆçº§ P1ï¼ˆé‡è¦ï¼‰**ï¼š
1. â³ å®ç°è¯­éŸ³åˆæˆï¼ˆTTSï¼‰å›å¤
2. â³ æ·»åŠ æ›´å¤š ASR æä¾›å•†ï¼ˆç™¾åº¦ã€è®¯é£ï¼‰
3. â³ å®ç°ç¦»çº¿è¯­éŸ³è¯†åˆ«ï¼ˆWhisperï¼‰
4. â³ æ·»åŠ çŸ¥è¯†åº“æ”¯æŒæ›´å¤šæ–‡æ¡£æ ¼å¼ï¼ˆPDFã€Wordï¼‰
5. â³ å®ç°äº‘ç«¯åŒæ­¥ï¼ˆå¯é€‰ï¼‰

**ä¼˜å…ˆçº§ P2ï¼ˆå¯é€‰ï¼‰**ï¼š
1. â³ å¤šè¯­è¨€ç•Œé¢æ”¯æŒï¼ˆå›½é™…åŒ–ï¼‰
2. â³ ä¸»é¢˜å®šåˆ¶åŠŸèƒ½
3. â³ æ’ä»¶å¸‚åœº
4. â³ ç§»åŠ¨ç«¯åº”ç”¨ï¼ˆReact Nativeï¼‰

#### 10.2.3 é•¿æœŸæ”¹è¿›ï¼ˆ3-6 æœˆï¼‰

**ä¼˜å…ˆçº§ P1ï¼ˆé‡è¦ï¼‰**ï¼š
1. â³ åä½œç¼–è¾‘åŠŸèƒ½
2. â³ ä¼ä¸šç‰ˆåŠŸèƒ½ï¼ˆæƒé™ç®¡ç†ã€å›¢é˜Ÿç®¡ç†ï¼‰
3. â³ é«˜çº§åˆ†æåŠŸèƒ½ï¼ˆæ•°æ®ç»Ÿè®¡ã€å¯è§†åŒ–ï¼‰
4. â³ AI è®­ç»ƒä¸ä¼˜åŒ–ï¼ˆè‡ªå®šä¹‰æ¨¡å‹ï¼‰

### 10.3 æ¶æ„æ”¹è¿›å»ºè®®

#### 10.3.1 å¾®æœåŠ¡åŒ–

**å½“å‰æ¶æ„**ï¼šå•ä½“åº”ç”¨ï¼ˆAPI Server + ASR + LLM + Storageï¼‰

**å»ºè®®æ¶æ„**ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            API Gateway                  â”‚
â”‚         (Kong / Traefik)                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚        â”‚        â”‚            â”‚
â”Œâ”€â”€â”€â–¼â”€â”€â”€â” â”Œâ”€â–¼â”€â”€â” â”Œâ”€â”€â”€â–¼â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
â”‚  ASR  â”‚ â”‚ LLMâ”‚ â”‚Storageâ”‚ â”‚ Knowledge   â”‚
â”‚Serviceâ”‚ â”‚Svc â”‚ â”‚Serviceâ”‚ â”‚   Service   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ä¼˜åŠ¿**ï¼š
- ç‹¬ç«‹æ‰©å±•å„æœåŠ¡
- æ•…éšœéš”ç¦»
- æŠ€æœ¯æ ˆçµæ´»

**åŠ£åŠ¿**ï¼š
- éƒ¨ç½²å¤æ‚åº¦å¢åŠ 
- ç½‘ç»œå»¶è¿Ÿå¢åŠ 
- å¼€å‘è°ƒè¯•å¤æ‚

**å»ºè®®**ï¼šä¸­å°å‹éƒ¨ç½²ç»§ç»­ä½¿ç”¨å•ä½“ï¼Œå¤§è§„æ¨¡éƒ¨ç½²è€ƒè™‘å¾®æœåŠ¡ã€‚

#### 10.3.2 äº‹ä»¶é©±åŠ¨æ¶æ„

**ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—è§£è€¦**ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ASR    â”‚â”€â”€â”€>â”‚  RabbitMQâ”‚â”€â”€â”€>â”‚Processor â”‚
â”‚ Service â”‚    â”‚  / Redis â”‚    â”‚ Service  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚WebSocket â”‚
              â”‚Broadcast â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ä¼˜åŠ¿**ï¼š
- å¼‚æ­¥å¤„ç†ï¼Œæé«˜ååé‡
- å‰Šå³°å¡«è°·
- æ˜“äºæ‰©å±•æ¶ˆè´¹è€…

#### 10.3.3 æ’ä»¶ç³»ç»Ÿå®Œå–„

**å½“å‰çŠ¶æ€**ï¼šPlugin Manager å·²å®ç°ä½†æœªä½¿ç”¨

**å»ºè®®å®ç°å®Œæ•´æ’ä»¶ç³»ç»Ÿ**ï¼š
```python
# æ’ä»¶æ¥å£
class PluginInterface:
    def on_asr_result(self, text: str):
        """ASR ç»“æœé’©å­"""
        pass
    
    def on_llm_response(self, response: str):
        """LLM å“åº”é’©å­"""
        pass

# æ’ä»¶ç¤ºä¾‹ï¼šè‡ªåŠ¨ç¿»è¯‘æ’ä»¶
class TranslationPlugin(PluginInterface):
    def on_asr_result(self, text: str):
        translated = translate(text, target='en')
        return translated
    
    def on_llm_response(self, response: str):
        translated = translate(response, target='zh')
        return translated

# åŠ è½½æ’ä»¶
plugin_manager.register(TranslationPlugin())
```

---

## 11. é™„å½•

### 11.1 æŠ€æœ¯æ ˆç‰ˆæœ¬æ¸…å•

#### 11.1.1 å‰ç«¯ä¾èµ–

| åŒ…å | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|
| electron | ^28.0.0 | æ¡Œé¢åº”ç”¨æ¡†æ¶ |
| react | ^18.2.0 | UI æ¡†æ¶ |
| react-dom | ^18.2.0 | React DOM æ¸²æŸ“ |
| typescript | ^5.0.0 | ç±»å‹å®‰å…¨ |
| vite | ^5.0.0 | æ„å»ºå·¥å…· |
| concurrently | ^8.2.0 | å¹¶å‘è¿è¡Œè„šæœ¬ |
| wait-on | ^7.2.0 | ç­‰å¾…æœåŠ¡å¯åŠ¨ |

#### 11.1.2 åç«¯ä¾èµ–

| åŒ…å | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|
| fastapi | >=0.104.0 | Web æ¡†æ¶ |
| uvicorn | >=0.24.0 | ASGI æœåŠ¡å™¨ |
| websockets | >=12.0 | WebSocket æ”¯æŒ |
| aiohttp | >=3.12.0 | å¼‚æ­¥ HTTP å®¢æˆ·ç«¯ |
| sounddevice | >=0.5.0 | éŸ³é¢‘å½•åˆ¶ |
| numpy | >=1.24.0 | æ•°å€¼è®¡ç®— |
| PyYAML | >=6.0.0 | é…ç½®æ–‡ä»¶è§£æ |
| litellm | >=1.0.0 | LLM ç»Ÿä¸€æ¥å£ |
| sentence-transformers | >=2.2.2 | Embedding æ¨¡å‹ |
| chromadb | >=0.4.22 | å‘é‡æ•°æ®åº“ |
| webrtcvad | >=2.0.10 | VAD è¯­éŸ³æ£€æµ‹ |

### 11.2 API ç«¯ç‚¹æ¸…å•

#### 11.2.1 å½•éŸ³æ§åˆ¶ç±»

| ç«¯ç‚¹ | æ–¹æ³• | è¯´æ˜ |
|------|------|------|
| `/api/recording/start` | POST | å¯åŠ¨å½•éŸ³ |
| `/api/recording/stop` | POST | åœæ­¢å½•éŸ³ |
| `/api/recording/pause` | POST | æš‚åœå½•éŸ³ |
| `/api/recording/resume` | POST | æ¢å¤å½•éŸ³ |

#### 11.2.2 LLM å¯¹è¯ç±»

| ç«¯ç‚¹ | æ–¹æ³• | è¯´æ˜ |
|------|------|------|
| `/api/llm/chat` | POST | LLM å¯¹è¯ï¼ˆæµå¼ï¼‰ |
| `/api/smartchat/chat` | POST | æ™ºèƒ½åŠ©æ‰‹å¯¹è¯ï¼ˆRAGï¼‰ |
| `/api/zen/chat` | POST | ç¦…å¯¹è¯ |
| `/api/summary/generate` | POST | ç”Ÿæˆæ‘˜è¦ |

#### 11.2.3 çŸ¥è¯†åº“ç±»

| ç«¯ç‚¹ | æ–¹æ³• | è¯´æ˜ |
|------|------|------|
| `/api/knowledge/upload` | POST | ä¸Šä¼ æ–‡æ¡£ |
| `/api/knowledge/files` | GET | è·å–æ–‡æ¡£åˆ—è¡¨ |
| `/api/knowledge/file/{filename}` | GET | è·å–æ–‡æ¡£å†…å®¹ |
| `/api/knowledge/file/{filename}` | DELETE | åˆ é™¤æ–‡æ¡£ |
| `/api/knowledge/query` | POST | æŸ¥è¯¢çŸ¥è¯†åº“ |

#### 11.2.4 å†å²è®°å½•ç±»

| ç«¯ç‚¹ | æ–¹æ³• | è¯´æ˜ |
|------|------|------|
| `/api/records` | GET | è·å–å†å²è®°å½•åˆ—è¡¨ |
| `/api/records/{id}` | GET | è·å–å•æ¡è®°å½• |
| `/api/records/{id}` | DELETE | åˆ é™¤å•æ¡è®°å½• |
| `/api/records/delete` | POST | æ‰¹é‡åˆ é™¤è®°å½• |
| `/api/text/save` | POST | ä¿å­˜æ–‡æœ¬è®°å½• |

#### 11.2.5 ç³»ç»Ÿç±»

| ç«¯ç‚¹ | æ–¹æ³• | è¯´æ˜ |
|------|------|------|
| `/api/status` | GET | ç³»ç»ŸçŠ¶æ€ |
| `/api/audio/devices` | GET | éŸ³é¢‘è®¾å¤‡åˆ—è¡¨ |
| `/api/audio/set_device` | POST | è®¾ç½®éŸ³é¢‘è®¾å¤‡ |
| `/health` | GET | å¥åº·æ£€æŸ¥ |

### 11.3 é”™è¯¯ä»£ç æ¸…å•

#### 11.3.1 ç½‘ç»œé”™è¯¯ (1000-1999)

| ä»£ç  | è¯´æ˜ |
|------|------|
| 1000 | ç½‘ç»œä¸å¯è¾¾ |
| 1001 | API æœåŠ¡å™¨ä¸å¯ç”¨ |
| 1002 | WebSocket è¿æ¥å¤±è´¥ |
| 1003 | WebSocket è¿æ¥æ–­å¼€ |
| 1004 | ç½‘ç»œè¶…æ—¶ |

#### 11.3.2 éŸ³é¢‘é”™è¯¯ (2000-2999)

| ä»£ç  | è¯´æ˜ |
|------|------|
| 2000 | æœªæ‰¾åˆ°éŸ³é¢‘è®¾å¤‡ |
| 2001 | éŸ³é¢‘è®¾å¤‡é”™è¯¯ |
| 2002 | éŸ³é¢‘å½•åˆ¶å¤±è´¥ |
| 2003 | éŸ³é¢‘æ ¼å¼ä¸æ”¯æŒ |

#### 11.3.3 ASR é”™è¯¯ (3000-3999)

| ä»£ç  | è¯´æ˜ |
|------|------|
| 3000 | ASR é…ç½®é”™è¯¯ |
| 3001 | ASR å¯åŠ¨å¤±è´¥ |
| 3002 | ASR è¯†åˆ«å¤±è´¥ |
| 3003 | ASR è¿æ¥å¤±è´¥ |

#### 11.3.4 LLM é”™è¯¯ (4000-4999)

| ä»£ç  | è¯´æ˜ |
|------|------|
| 4000 | LLM é…ç½®é”™è¯¯ |
| 4001 | LLM è¯·æ±‚å¤±è´¥ |
| 4002 | LLM å“åº”è¶…æ—¶ |
| 4003 | LLM API å¯†é’¥æ— æ•ˆ |
| 4004 | LLM é…é¢ä¸è¶³ |

#### 11.3.5 å­˜å‚¨é”™è¯¯ (5000-5999)

| ä»£ç  | è¯´æ˜ |
|------|------|
| 5000 | æ•°æ®åº“è¿æ¥å¤±è´¥ |
| 5001 | å­˜å‚¨å†™å…¥å¤±è´¥ |
| 5002 | å­˜å‚¨è¯»å–å¤±è´¥ |
| 5003 | å­˜å‚¨åˆ é™¤å¤±è´¥ |
| 5004 | ç£ç›˜ç©ºé—´ä¸è¶³ |

### 11.4 é…ç½®å‚æ•°è¯´æ˜

#### 11.4.1 ASR é…ç½®

```yaml
asr:
  base_url: wss://openspeech.bytedance.com/api/v3/sauc/bigmodel  # ASR WebSocket åœ°å€
  app_id: "your-app-id"                   # åº”ç”¨ ID
  app_key: "your-app-key"                 # åº”ç”¨å¯†é’¥
  access_key: "your-access-key"           # è®¿é—®å¯†é’¥
  language: zh-CN                         # è¯­è¨€ï¼ˆzh-CN, en-USï¼‰
  format: pcm                             # éŸ³é¢‘æ ¼å¼
  rate: 16000                             # é‡‡æ ·ç‡
  bits: 16                                # ä½æ·±åº¦
  channel: 1                              # å£°é“æ•°
  codec: raw                              # ç¼–è§£ç å™¨
  version: "bigmodel_async"               # ASR ç‰ˆæœ¬ï¼ˆbigmodel_async, bigmodel, bigmodel_nostreamï¼‰
  enable_second_recognition: false        # äºŒéè¯†åˆ«ï¼ˆæé«˜å‡†ç¡®ç‡ï¼‰
```

#### 11.4.2 VAD é…ç½®

```yaml
vad:
  enabled: true                           # å¯ç”¨ VAD
  mode: 2                                 # æ•æ„Ÿåº¦ 0-3ï¼ˆ0: è´¨é‡ä¼˜å…ˆï¼Œ3: æ•æ„Ÿåº¦ä¼˜å…ˆï¼‰
  speech_start_threshold: 2               # è¯­éŸ³å¼€å§‹é˜ˆå€¼ï¼ˆè¿ç»­æ£€æµ‹åˆ°è¯­éŸ³çš„å¸§æ•°ï¼‰
  speech_end_threshold: 10                # è¯­éŸ³ç»“æŸé˜ˆå€¼ï¼ˆè¿ç»­æ£€æµ‹åˆ°é™éŸ³çš„å¸§æ•°ï¼‰
  pre_speech_padding_ms: 100              # è¯­éŸ³å‰ç¼“å†²ï¼ˆmsï¼‰
  post_speech_padding_ms: 300             # è¯­éŸ³åç¼“å†²ï¼ˆmsï¼‰
```

#### 11.4.3 éŸ³é¢‘é…ç½®

```yaml
audio:
  format: WAV                             # æ ¼å¼ï¼ˆWAV, MP3ï¼‰
  channels: 1                             # å£°é“æ•°ï¼ˆ1: å•å£°é“ï¼Œ2: ç«‹ä½“å£°ï¼‰
  rate: 16000                             # é‡‡æ ·ç‡ï¼ˆHzï¼‰
  chunk: 1024                             # æ¯æ¬¡è¯»å–çš„æ ·æœ¬æ•°
  max_buffer_seconds: 60                  # æœ€å¤§ç¼“å†²æ—¶é•¿ï¼ˆç§’ï¼Œ0 è¡¨ç¤ºæ— é™åˆ¶ï¼‰
```

#### 11.4.4 LLM é…ç½®

```yaml
llm:
  provider: perfxcloud-ä¸“çº¿               # LLM æä¾›å•†åç§°
  api_key: "your-api-key"                 # API å¯†é’¥
  base_url: https://api.example.com/v1    # API åŸºç¡€ URL
  model: openai/Qwen3-Next-80B-Instruct   # æ¨¡å‹åç§°
  max_context_tokens: 128000              # æœ€å¤§ä¸Šä¸‹æ–‡ä»¤ç‰Œæ•°
  temperature: 0.7                        # æ¸©åº¦ï¼ˆ0-1ï¼Œæ§åˆ¶åˆ›é€ æ€§ï¼‰
  top_p: 0.9                              # Top-p é‡‡æ ·
  max_tokens: 4000                        # æœ€å¤§ç”Ÿæˆä»¤ç‰Œæ•°
  stream: true                            # æµå¼è¾“å‡º
```

#### 11.4.5 çŸ¥è¯†åº“é…ç½®

```yaml
knowledge:
  data_dir: ./data/knowledge              # çŸ¥è¯†åº“æ•°æ®ç›®å½•
  embedding_model: all-MiniLM-L6-v2       # Embedding æ¨¡å‹
  chunk_size: 1000                        # æ–‡æ¡£åˆ†å—å¤§å°ï¼ˆå­—ç¬¦ï¼‰
  chunk_overlap: 200                      # åˆ†å—é‡å å¤§å°ï¼ˆå­—ç¬¦ï¼‰
  top_k: 3                                # æ£€ç´¢è¿”å›ç»“æœæ•°é‡
```

#### 11.4.6 å­˜å‚¨é…ç½®

```yaml
storage:
  type: sqlite                            # å­˜å‚¨ç±»å‹ï¼ˆsqlite, postgresqlï¼‰
  path: ~/.voice_assistant/history.db     # SQLite æ•°æ®åº“è·¯å¾„
```

### 11.5 é¡¹ç›®é‡Œç¨‹ç¢‘

| ç‰ˆæœ¬ | æ—¥æœŸ | ä¸»è¦ç‰¹æ€§ |
|------|------|---------|
| 1.0.0 | 2025-12-20 | åŸºç¡€è¯­éŸ³è¯†åˆ«å’Œ LLM é›†æˆ |
| 1.1.0 | 2025-12-25 | æ·»åŠ è¯­éŸ³ç¬”è®°åº”ç”¨ |
| 1.2.0 | 2025-12-28 | æ·»åŠ æ™ºèƒ½åŠ©æ‰‹å’ŒçŸ¥è¯†åº“ |
| 1.3.0 | 2025-12-31 | æ·»åŠ ç¦…åº”ç”¨å’Œå¤šåº”ç”¨æ¶æ„ |
| 1.4.0 | 2026-01-02 | Agent ç³»ç»Ÿå’Œæµå¼æ‘˜è¦ |
| 1.4.1 | 2026-01-03 | ä»»åŠ¡æ¢å¤åŠŸèƒ½å’Œä¼˜åŒ– |
| 1.5.0 | å¾…å®š | TTSã€å…¨å±€å¿«æ·é”®ã€æ›´å¤š ASR |
| 2.0.0 | å¾…å®š | å¾®æœåŠ¡æ¶æ„ã€äº‘ç«¯åŒæ­¥ |

### 11.6 è´¡çŒ®è€…

| è§’è‰² | è´¡çŒ® |
|------|------|
| æ·±åœ³ç‹å“¥ | é¡¹ç›®è´Ÿè´£äººã€æ¶æ„è®¾è®¡ã€åç«¯å¼€å‘ |
| AI åŠ©æ‰‹ | ä»£ç å®ç°ã€æ–‡æ¡£ç¼–å†™ã€é—®é¢˜è§£å†³ |

### 11.7 å‚è€ƒèµ„æ–™

**å®˜æ–¹æ–‡æ¡£**ï¼š
- [FastAPI æ–‡æ¡£](https://fastapi.tiangolo.com/)
- [Electron æ–‡æ¡£](https://www.electronjs.org/docs)
- [React æ–‡æ¡£](https://react.dev/)
- [LiteLLM æ–‡æ¡£](https://docs.litellm.ai/)
- [ChromaDB æ–‡æ¡£](https://docs.trychroma.com/)

**ç¬¬ä¸‰æ–¹æœåŠ¡**ï¼š
- [ç«å±±å¼•æ“ ASR](https://www.volcengine.com/docs/6561/80818)
- [OpenAI API](https://platform.openai.com/docs)
- [WebRTC VAD](https://github.com/wiseman/py-webrtcvad)

**æŠ€æœ¯æ–‡ç« **ï¼š
- [å‰åç«¯åˆ†ç¦»æ¶æ„æœ€ä½³å®è·µ](https://example.com)
- [Electron åº”ç”¨æ€§èƒ½ä¼˜åŒ–](https://example.com)
- [Python å¼‚æ­¥ç¼–ç¨‹æŒ‡å—](https://example.com)

---

## 12. æ€»ç»“

### 12.1 é¡¹ç›®ä¼˜åŠ¿

**æŠ€æœ¯ä¼˜åŠ¿**ï¼š
1. âœ… **æ¶æ„æ¸…æ™°**ï¼šå‰åç«¯åˆ†ç¦»ï¼Œæ¨¡å—åŒ–è®¾è®¡
2. âœ… **å¯æ‰©å±•æ€§å¼º**ï¼šæ’ä»¶åŒ–æ¶æ„ï¼Œæ˜“äºæ·»åŠ æ–°åŠŸèƒ½
3. âœ… **æŠ€æœ¯å…ˆè¿›**ï¼šä½¿ç”¨æœ€æ–°çš„ AI æŠ€æœ¯ï¼ˆLLMã€RAGï¼‰
4. âœ… **æ€§èƒ½ä¼˜ç§€**ï¼šå¼‚æ­¥å¤„ç†ï¼Œæµå¼å“åº”
5. âœ… **è·¨å¹³å°**ï¼šæ”¯æŒ macOSã€Linuxã€Windows

**ä¸šåŠ¡ä¼˜åŠ¿**ï¼š
1. âœ… **åŠŸèƒ½ä¸°å¯Œ**ï¼š4 ä¸ªç‹¬ç«‹åº”ç”¨æ»¡è¶³ä¸åŒåœºæ™¯
2. âœ… **ç”¨æˆ·ä½“éªŒå¥½**ï¼šå®æ—¶åé¦ˆï¼Œæµç•…äº¤äº’
3. âœ… **æœ¬åœ°åŒ–**ï¼šæ•°æ®å®‰å…¨ï¼Œæ— éœ€ä¸Šä¼ 
4. âœ… **çµæ´»é…ç½®**ï¼šæ”¯æŒå¤šç§ ASR å’Œ LLM æœåŠ¡

### 12.2 é¡¹ç›®ä¸è¶³

**æŠ€æœ¯å±‚é¢**ï¼š
1. âŒ ç¼ºå°‘è‡ªåŠ¨åŒ–æµ‹è¯•
2. âŒ éƒ¨åˆ†ä»£ç å¤æ‚åº¦è¾ƒé«˜
3. âš ï¸ ç›‘æ§å’Œå‘Šè­¦ä¸å®Œå–„
4. âš ï¸ å®‰å…¨æªæ–½éœ€åŠ å¼º

**åŠŸèƒ½å±‚é¢**ï¼š
1. â³ ç¼ºå°‘ TTS åŠŸèƒ½
2. â³ ä¸æ”¯æŒç¦»çº¿è¯†åˆ«
3. â³ çŸ¥è¯†åº“åŠŸèƒ½è¾ƒç®€å•
4. â³ ç¼ºå°‘åä½œåŠŸèƒ½

### 12.3 å‘å±•å»ºè®®

**çŸ­æœŸç›®æ ‡ï¼ˆ1-2 æœˆï¼‰**ï¼š
1. âœ… è¡¥å……æµ‹è¯•è¦†ç›–
2. âœ… ä¼˜åŒ–ä»£ç ç»“æ„
3. âœ… å®Œå–„æ–‡æ¡£
4. âœ… ä¿®å¤å·²çŸ¥é—®é¢˜

**ä¸­æœŸç›®æ ‡ï¼ˆ3-6 æœˆï¼‰**ï¼š
1. â³ æ·»åŠ  TTS åŠŸèƒ½
2. â³ å®ç°ç¦»çº¿è¯†åˆ«
3. â³ å®Œå–„çŸ¥è¯†åº“
4. â³ å®ç°äº‘ç«¯åŒæ­¥

**é•¿æœŸç›®æ ‡ï¼ˆ6-12 æœˆï¼‰**ï¼š
1. â³ å¾®æœåŠ¡æ¶æ„
2. â³ ä¼ä¸šç‰ˆåŠŸèƒ½
3. â³ ç§»åŠ¨ç«¯åº”ç”¨
4. â³ æ’ä»¶å¸‚åœº

### 12.4 ç»“è¯­

MindVoice æ˜¯ä¸€ä¸ªæŠ€æœ¯å…ˆè¿›ã€åŠŸèƒ½ä¸°å¯Œçš„è¯­éŸ³åŠ©æ‰‹é¡¹ç›®ã€‚é€šè¿‡å‰åç«¯åˆ†ç¦»çš„æ¶æ„è®¾è®¡ï¼Œé¡¹ç›®å…·æœ‰è‰¯å¥½çš„å¯ç»´æŠ¤æ€§å’Œå¯æ‰©å±•æ€§ã€‚

**é¡¹ç›®äº®ç‚¹**ï¼š
- ğŸ¯ æ¸…æ™°çš„æ¶æ„è®¾è®¡
- ğŸš€ å…ˆè¿›çš„ AI æŠ€æœ¯é›†æˆ
- ğŸ’ª çµæ´»çš„æ’ä»¶åŒ–ç³»ç»Ÿ
- âš¡ ä¼˜ç§€çš„æ€§èƒ½è¡¨ç°

**æ”¹è¿›æ–¹å‘**ï¼š
- ğŸ“ åŠ å¼ºæµ‹è¯•è¦†ç›–
- ğŸ”’ æå‡å®‰å…¨æ€§
- ğŸ“Š å®Œå–„ç›‘æ§ä½“ç³»
- ğŸŒ æ‰©å±•åŠŸèƒ½è¾¹ç•Œ

éšç€æŒç»­çš„è¿­ä»£å’Œä¼˜åŒ–ï¼ŒMindVoice æœ‰æœ›æˆä¸ºä¸€ä¸ªæˆç†Ÿçš„å•†ä¸šåŒ–äº§å“ã€‚

---

**æŠ¥å‘Šç¼–å†™æ—¥æœŸ**: 2026-01-03  
**æŠ¥å‘Šç‰ˆæœ¬**: 1.0  
**ä¸‹æ¬¡æ›´æ–°**: æ ¹æ®é¡¹ç›®è¿›å±•å®šæœŸæ›´æ–°

**è”ç³»æ–¹å¼**ï¼š
- Email: manwjh@126.com
- é¡¹ç›®åœ°å€: [GitHub Repository]

---

**å…è´£å£°æ˜**: æœ¬æŠ¥å‘ŠåŸºäºå½“å‰é¡¹ç›®ä»£ç å’Œæ–‡æ¡£ç¼–å†™ï¼Œå®é™…æ€§èƒ½å’ŒåŠŸèƒ½å¯èƒ½å› ç¯å¢ƒã€é…ç½®å’Œä½¿ç”¨æ–¹å¼è€Œæœ‰æ‰€ä¸åŒã€‚æŠ¥å‘Šä¸­çš„æ”¹è¿›å»ºè®®ä»…ä¾›å‚è€ƒï¼Œå®æ–½å‰éœ€æ ¹æ®å®é™…æƒ…å†µè¯„ä¼°ã€‚

