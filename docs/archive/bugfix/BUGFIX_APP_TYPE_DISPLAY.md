# Bugä¿®å¤ï¼šå†å²è®°å½•æ˜¾ç¤ºé”™è¯¯çš„ app_type

**é—®é¢˜å‘ç°**: 2026-01-06  
**ä¿®å¤æ—¶é—´**: 2026-01-06  

---

## ğŸ› é—®é¢˜æè¿°

**ç—‡çŠ¶**: 
- ç”¨æˆ·åœ¨å†å²è®°å½•åˆ—è¡¨ä¸­çœ‹åˆ°ä¸€æ¡ SmartChat çš„å¯¹è¯è®°å½•
- ä½†ç•Œé¢æ˜¾ç¤ºä¸º"ğŸ“ è¯­éŸ³ç¬”è®°"
- ç‚¹å‡»"ğŸ“ æ¢å¤ä»»åŠ¡"æŒ‰é’®

**å®é™…æƒ…å†µ**:
- æ•°æ®åº“ä¸­è¯¥è®°å½•çš„ `app_type` å­—æ®µæ˜¯ `'smart-chat'`
- è®°å½•å†…å®¹æ˜æ˜¾æ˜¯å¯¹è¯æ ¼å¼ï¼š`[ç”¨æˆ·] ... [åŠ©æ‰‹] ...`

---

## ğŸ” é—®é¢˜è¯Šæ–­

### 1. æ£€æŸ¥æ•°æ®åº“
```sql
SELECT id, app_type, substr(text, 1, 50) as preview
FROM records 
WHERE created_at >= '2026-01-06 01:52:00'
ORDER BY created_at DESC;
```

**ç»“æœ**: 
```
id: 6df26498-78d0-4f49-a8ea-16e4640120c9
app_type: smart-chat  âœ… æ•°æ®åº“æ­£ç¡®
text: [ç”¨æˆ·] 01:52 ä½ å¥½å‘€ [åŠ©æ‰‹] 01:52 ...
```

### 2. æ£€æŸ¥ API å“åº”
```bash
curl "http://127.0.0.1:8765/api/records?limit=1"
```

**ç»“æœ**:
```json
{
  "records": [
    {
      "id": "6df26498-...",
      "text": "[ç”¨æˆ·] ...",
      "metadata": {...},
      "created_at": "2026-01-06 01:52:42"
      // âŒ ç¼ºå°‘ app_type å­—æ®µï¼
    }
  ]
}
```

### 3. å‰ç«¯æ¸²æŸ“é€»è¾‘
```typescript
// HistoryView.tsx:105
const getAppBadge = (appType?: string) => {
  const config = APP_TYPE_CONFIG[appType || 'voice-note'];  // ğŸ‘ˆ é»˜è®¤ä½¿ç”¨ 'voice-note'
  ...
}
```

**ç»“è®º**: API æ²¡æœ‰è¿”å› `app_type` å­—æ®µï¼Œå‰ç«¯é™çº§åˆ°é»˜è®¤å€¼ `'voice-note'`ã€‚

---

## ğŸ”§ ä¿®å¤æ–¹æ¡ˆ

### åç«¯ä¿®å¤ï¼ˆ`src/api/server.py`ï¼‰

**æ–‡ä»¶**: `src/api/server.py`  
**ä½ç½®**: `/api/records` ç«¯ç‚¹ï¼Œline 1108-1116

**ä¿®æ”¹å‰**:
```python
record_items = [
    RecordItem(
        id=r['id'],
        text=r['text'],
        metadata=r.get('metadata', {}),
        created_at=r.get('created_at', '')
        # âŒ ç¼ºå°‘ app_type
    )
    for r in records
]
```

**ä¿®æ”¹å**:
```python
record_items = [
    RecordItem(
        id=r['id'],
        text=r['text'],
        metadata=r.get('metadata', {}),
        app_type=r.get('app_type', 'voice-note'),  # âœ… æ·»åŠ  app_type
        created_at=r.get('created_at', '')
    )
    for r in records
]
```

---

## âœ… ä¿®å¤éªŒè¯

### 1. é‡å¯åç«¯
```bash
source venv/bin/activate
python src/api/server.py
```

### 2. æµ‹è¯• API å“åº”
```bash
curl -s "http://127.0.0.1:8765/api/records?limit=1" | python3 -m json.tool
```

**é¢„æœŸç»“æœ**:
```json
{
  "records": [
    {
      "id": "6df26498-...",
      "text": "[ç”¨æˆ·] ...",
      "metadata": {...},
      "app_type": "smart-chat",  // âœ… ç°åœ¨åŒ…å«äº†ï¼
      "created_at": "2026-01-06 01:52:42"
    }
  ]
}
```

### 3. å‰ç«¯åˆ·æ–°éªŒè¯
- **æ“ä½œ**: åˆ·æ–°å‰ç«¯é¡µé¢ï¼ˆCmd+Shift+Rï¼‰
- **å¯¼èˆª**: å†å²è®°å½• â†’ æŸ¥çœ‹è®°å½•åˆ—è¡¨
- **é¢„æœŸ**:
  - SmartChat è®°å½•æ˜¾ç¤ºä¸º "ğŸ’¬ æ™ºèƒ½åŠ©æ‰‹"ï¼ˆç´«è‰²å¾½ç« ï¼‰
  - VoiceNote è®°å½•æ˜¾ç¤ºä¸º "ğŸ“ è¯­éŸ³ç¬”è®°"ï¼ˆè“è‰²å¾½ç« ï¼‰

---

## ğŸ“‹ ç›¸å…³ä»£ç æ–‡ä»¶

### åç«¯
- âœ… `src/api/server.py` - ä¿®å¤ `/api/records` ç«¯ç‚¹
- âœ… `src/providers/storage/sqlite.py` - `list_records()` å·²åŒ…å« `app_type`

### å‰ç«¯
- âœ… `electron-app/src/components/shared/HistoryView.tsx` - æ¸²æŸ“å¾½ç« é€»è¾‘æ­£ç¡®
- âœ… `electron-app/src/App.tsx` - `loadRecord()` æ ¹æ® `app_type` åˆ†åˆ«å¤„ç†

---

## ğŸ¯ å½±å“èŒƒå›´

### ä¿®å¤å‰
- âŒ æ‰€æœ‰è®°å½•åœ¨åˆ—è¡¨ä¸­éƒ½æ˜¾ç¤ºä¸º"è¯­éŸ³ç¬”è®°"
- âŒ ç”¨æˆ·æ— æ³•åŒºåˆ†ä¸åŒåº”ç”¨çš„è®°å½•
- âŒ ç­›é€‰åŠŸèƒ½å¤±æ•ˆï¼ˆå› ä¸ºå‰ç«¯ä¸çŸ¥é“çœŸå®ç±»å‹ï¼‰

### ä¿®å¤å
- âœ… SmartChat è®°å½•æ˜¾ç¤ºä¸º "ğŸ’¬ æ™ºèƒ½åŠ©æ‰‹"
- âœ… VoiceNote è®°å½•æ˜¾ç¤ºä¸º "ğŸ“ è¯­éŸ³ç¬”è®°"
- âœ… VoiceZen è®°å½•æ˜¾ç¤ºä¸º "ğŸ§˜ ç¦…"
- âœ… ç­›é€‰åŠŸèƒ½æ­£å¸¸å·¥ä½œ

---

## ğŸš€ æµ‹è¯•æ¸…å•

- [ ] é‡å¯åç«¯æœåŠ¡
- [ ] API è¿”å›åŒ…å« `app_type` å­—æ®µ
- [ ] å‰ç«¯åˆ·æ–°åè®°å½•æ˜¾ç¤ºæ­£ç¡®çš„å›¾æ ‡å’Œæ ‡ç­¾
- [ ] ç­›é€‰åŠŸèƒ½æ­£å¸¸ï¼ˆå…¨éƒ¨/è¯­éŸ³ç¬”è®°/æ™ºèƒ½åŠ©æ‰‹/ç¦…ï¼‰
- [ ] æ¢å¤åŠŸèƒ½æ­£å¸¸ï¼ˆç‚¹å‡»"æ¢å¤ä»»åŠ¡"åˆ‡æ¢åˆ°æ­£ç¡®çš„åº”ç”¨ï¼‰

---

## ğŸ“ ç»éªŒæ€»ç»“

### æ•™è®­
1. **API å“åº”æ¨¡å‹å’Œå®é™…æ„é€ è¦ä¸€è‡´**: è™½ç„¶å®šä¹‰äº† `RecordItem` æ¨¡å‹åŒ…å« `app_type`ï¼Œä½†æ„é€ æ—¶é—æ¼äº†ã€‚
2. **å‰ç«¯ä¸åº”è¯¥æœ‰é»˜è®¤é™çº§é€»è¾‘**: å¦‚æœ API ä¸è¿”å› `app_type`ï¼Œå‰ç«¯åº”è¯¥æŠ¥é”™è€Œä¸æ˜¯é»˜è®¤ä¸º `voice-note`ã€‚

### æ”¹è¿›å»ºè®®
1. **API æµ‹è¯•è¦†ç›–**: æ·»åŠ é›†æˆæµ‹è¯•éªŒè¯è¿”å›å­—æ®µçš„å®Œæ•´æ€§
2. **ç±»å‹æ£€æŸ¥**: ä½¿ç”¨ TypeScript ä¸¥æ ¼æ¨¡å¼ï¼Œé¿å…å¯é€‰å­—æ®µçš„é»˜è®¤å€¼é™·é˜±
3. **æ—¥å¿—è®°å½•**: å‰ç«¯åœ¨æ¥æ”¶åˆ°è®°å½•æ—¶æ‰“å° `app_type`ï¼Œæ–¹ä¾¿è°ƒè¯•

---

**çŠ¶æ€**: âœ… ä¿®å¤å®Œæˆï¼Œç­‰å¾…é‡å¯éªŒè¯
