# macOS 语音桌面助手配置文件示例
# 复制此文件为 config.yml 并填入你的配置信息
# 注意：config.yml 包含敏感信息，已添加到 .gitignore

# ASR 配置（火山引擎）
asr:
  base_url: wss://openspeech.bytedance.com/api/v3/sauc/bigmodel_async  # 双向流式优化版本（推荐）
  # 其他可选版本：
  # - bigmodel: 双向流式普通版本（每包输入对应每包返回）
  # - bigmodel_nostream: 流式输入模式（准确率更高，延迟较大）
  app_id: ""  # 请填入你的 app_id
  app_key: ""  # 请填入你的 app_key
  access_key: ""  # 请填入你的 access_key
  language: zh-CN  # 识别语言：zh-CN（中文）或 en-US（英语）
  enable_nonstream: true  # 二遍识别：双向流式实时返回 + 非流式重新识别分句片段（快+准，仅限 bigmodel_async）

# LLM 配置（大语言模型）
llm:
  provider: perfxcloud-专线  # 服务提供商
  api_key: ""  # 请填入你的 API Key
  base_url: https://deepseek.perfxlab.cn/v1  # API 基础 URL
  model: openai/Qwen3-Next-80B-Instruct  # 模型名称（使用 openai/ 前缀以支持自定义 OpenAI 兼容端点）
  max_context_tokens: 128000  # 最大上下文长度

# 存储配置
storage:
  path: ~/.voice_assistant/history.db  # 数据库路径

# 音频配置
audio:
  format: WAV  # 音频格式
  channels: 1  # 声道数（1=单声道，2=立体声）
  rate: 16000  # 采样率（Hz）
  chunk: 3200  # 每次读取的帧数（3200帧 = 200ms，符合火山引擎推荐的最优性能配置）
  # 说明：火山引擎建议单包音频大小为100~200ms，200ms性能最优
  # 计算公式：chunk = rate × 时长（秒）
  # - 200ms: 16000 × 0.2 = 3200帧（推荐）
  # - 100ms: 16000 × 0.1 = 1600帧
  
  # VAD配置（语音活动检测，用于过滤静音，节约ASR成本）
  vad:
    enabled: false  # 是否启用VAD（默认关闭，向后兼容）
    library: "webrtcvad"  # VAD库：webrtcvad
    mode: 2  # WebRTC VAD敏感度：0-3，越高越严格（推荐2）
    frame_duration_ms: 20  # VAD检测帧长度：10/20/30ms（推荐20ms）
    
    # 检测阈值（防止截断）
    speech_start_threshold: 2       # 连续N个块检测到语音才开始发送（40ms，避免开头截断）
    speech_end_threshold: 10        # 连续M个块静音才停止发送（200ms，避免中间截断）
    min_speech_duration_ms: 200     # 最小语音时长（毫秒），过滤短噪音
    
    # 缓冲机制（防止截断）
    pre_speech_padding_ms: 100      # 语音开始前缓冲（保留开头，避免"嗯..."被截断）
    post_speech_padding_ms: 300     # 语音结束后缓冲（保留结尾，避免语气词被截断）
  
  # VAD说明：
  # - 启用VAD可以过滤60-80%的静音音频，预计节约40-60%的ASR成本
  # - mode参数：0最宽松（可能误检），3最严格（可能漏检），2为平衡值
  # - 静音时不发送任何数据，最大化成本节约
  # - 长时间静音（>60秒）可能需要重连，延迟200-500ms（可接受）
  # - 如果发现截断问题，可以调整：
  #   * 减小 speech_start_threshold（更快开始）
  #   * 增大 speech_end_threshold（更晚结束）
  #   * 增大 pre/post_speech_padding_ms（更多缓冲）

# UI 配置
ui:
  theme: light  # 主题：light 或 dark
  position:
    x: 100  # 窗口 X 坐标
    y: 100  # 窗口 Y 坐标
  size:
    width: 500  # 窗口宽度
    height: 400  # 窗口高度

# 日志配置
logging:
  level: INFO  # 日志级别：DEBUG, INFO, WARNING, ERROR, CRITICAL
  console: true  # 是否输出到控制台
  file: true  # 是否输出到文件
  directory: logs  # 日志文件目录
  max_file_size_mb: 10  # 单个日志文件最大大小（MB）
  backup_count: 5  # 保留的日志文件数量
  format: "%(asctime)s | %(levelname)-8s | %(name)s | %(message)s"  # 日志格式
  date_format: "%Y-%m-%d %H:%M:%S"  # 时间格式
  
  # 分组件日志级别（可选，覆盖全局级别）
  components:
    ASR: INFO  # ASR服务日志级别
    LLM: INFO  # LLM服务日志级别
    AudioDevice: INFO  # 音频设备日志级别
    Network: INFO  # 网络相关日志级别
    Storage: INFO  # 存储相关日志级别